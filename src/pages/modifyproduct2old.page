<apex:page standardController="Opportunity" extensions="ModifyProductController2" Sidebar="false" showHeader="true" id="myPage" tabstyle="Opportunity">
    
    <head>
      <apex:styleSheet value="{!URLFOR($Resource.JQ_Spinner, '/jquery-ui-1.10.3.custom/development-bundle/themes/base/jquery.ui.all.css')}" />
        <apex:includeScript value="{!URLFOR($Resource.JQ_Spinner, '/jquery-ui-1.10.3.custom/development-bundle/jquery-1.9.1.js')}" />
        <apex:includeScript value="{!URLFOR($Resource.JQ_Spinner, '/jquery-ui-1.10.3.custom/development-bundle/external/jquery.mousewheel.js')}" />
        <apex:includeScript value="{!URLFOR($Resource.JQ_Spinner, '/jquery-ui-1.10.3.custom/development-bundle/ui/jquery.ui.core.js')}" />
        <apex:includeScript value="{!URLFOR($Resource.JQ_Spinner, '/jquery-ui-1.10.3.custom/development-bundle/ui/jquery.ui.widget.js')}" />
        <apex:includeScript value="{!URLFOR($Resource.JQ_Spinner, '/jquery-ui-1.10.3.custom/development-bundle/ui/jquery.ui.button.js')}" />
        <apex:includeScript value="{!URLFOR($Resource.JQ_Spinner, '/jquery-ui-1.10.3.custom/development-bundle/ui/jquery.ui.spinner.js')}" />
        
        <style type="text/css">
            .dateFormat {
                display:none;
            }
            .activeTab {
                background-color: #FDD017;
                color:white;
                background-image:none
            }
            .inactiveTab {
                background-color: #F3F3EC;
                color:black;
                background-image:none
            }
            .colHeader {
                font-weight:bold;
                border-bottom:1px solid #E3DEB8;
            }
            .colContent {
                border-bottom:1px solid #E3DEB8
            }
            html, body {
                // overflow-x: hidden;
            }
            .visibleDiv {
                border:1px solid gray;
                width:125px;
                background:#9E9E9E;
                height: 18px;
                text-align:left;
                padding-left:2px;
            }
            .mousehover {
                cursor:pointer;
            }
            div .enableStyle {
                background: url("/img/alohaSkin/btn_important.png") repeat-x scroll 0 0 transparent;
                border: 0 none;
                background-repeat: repeat-x;
                border-radius: 5px 5px 5px 5px;
                border-style: none;
                box-shadow: 0 2px 4px #AAAAAA;
                color: #FFFFFF;
                font-size: 0.95em;
                height: 21px;
                padding: 0 7px 3px;
                font-family: Arial, Helvetica, sans-serif;
            }
            body .btnDisabled:hover {
                background-position:0 0px;
            }
            div .enableStyle:hover {
                background-position:right -40;
                cursor:default;
            }
            div .enableStyle2 {
                background: url("/img/alohaSkin/btn_important.png") repeat-x scroll 0 0 transparent;
                border: 0 none;
                background-repeat: repeat-x;
                border-radius: 5px 5px 5px 5px;
                border-style: none;
                box-shadow: 0 2px 4px #AAAAAA;
                color: #FFFFFF;
                font-size: 0.95em;
                height: 21px;
                padding: 0 7px 3px;
                cursor: pointer;
                font-family: Arial, Helvetica, sans-serif;
            }
            div .btnNotDisplaying {
                border: 0 none;
                background-repeat: repeat-x;
                border-radius: 5px 5px 5px 5px;
                border-style: none;
                box-shadow: 0 2px 4px #AAAAAA;
                font-size: 0.95em;
                height: 20px;
                padding: 0 7px 2px;
                cursor: pointer;
                font-family: Arial, Helvetica, sans-serif;
            }
            div .disableStyle {
                background: none;
                border: 0 none;
                border-radius: 5px 5px 5px 5px;
                border-style: none;
                box-shadow: 0 2px 4px #AAAAAA;
                color: #909090;
                font-size: 0.95em;
                height: 20px;
                padding: 0 7px 2px;
                cursor:default;
                font-family: Arial, Helvetica, sans-serif;
                disabled:true;
            }
            .ui-corner-all {
                border-bottom-right-radius: 0;
                border-bottom-left-radius: 0;
                border-top-right-radius: 0;
                border-top-left-radius: 0;
                margin-bottom: 2px;
            }
        </style>
        
        <script type="text/javascript">
            var jq = jQuery.noConflict();

            function changeBC(index, fixedPrice) {


                index = checkCurrentPosition(index);

                var sp = document.getElementById('myPage:myForm:MyPageBlock:myRepeat2:' + index + ':Sales_Price');
                var bc = document.getElementById('myPage:myForm:MyPageBlock:myRepeat2:' + index + ':BillingCategory');
                var qt = document.getElementById('myPage:myForm:MyPageBlock:myRepeat2:' + index + ':Quantity');


                var a = bc.value;
                var b = 'fix price';
                var c = 'cpm';


                if (fixedPrice == 'true') {

                    if (a.toLowerCase() == b.toLowerCase() || a.toLowerCase() == c.toLowerCase()) {

                        sp.disabled = true;
                    } else {

                        sp.disabled = false;
                    }
                }
                if (a.toLowerCase() == b.toLowerCase() && qt.value == '') {

                    qt.value = 1;
                }
            }

            function getWidth() {
                return (typeof window.innerWidth != 'undefined' ? window.innerWidth : document.documentElement.clientWidth);
            }

            function setPosition(value) {
                var doc = document.getElementById("myPage:myForm:SelPosition");
                doc.value = value;
            }

            function setToDate(index) {

                var start = document.getElementById('myPage:myForm:MyPageBlock:myRepeat1:' + index + ':startDate').value;
                var end = document.getElementById('myPage:myForm:MyPageBlock:myRepeat1:' + index + ':endDate').value;

                if (start != '' && end == '') {
                    document.getElementById('myPage:myForm:MyPageBlock:myRepeat1:' + index + ':endDate').value = start;
                    DatePicker.pickDate(true, 'myPage:myForm:MyPageBlock:myRepeat1:' + index + ':endDate', false);
                }

            }

            function setColumn(value) {
                var doc = document.getElementById("myPage:myForm:SelColumn");
                doc.value = value;
            }

            function cancel() {
                document.getElementById('overlayBackground').style.display = 'none';
                document.getElementById('InlineEditDialog').style.display = 'none';

            }

            function cancelCx() {
                document.getElementById('overlayBackground').style.display = 'none';
                document.getElementById('InlineCopyDialog').style.display = 'none';

            }

            function days_between(date1, date2) {
                // The number of milliseconds in one day
                var ONE_DAY = 1000 * 60 * 60 * 24;
                // Convert both dates to milliseconds
                var date1_ms = date1.getTime();
                var date2_ms = date2.getTime();
                // Calculate the difference in milliseconds
                var difference_ms = Math.abs(date1_ms - date2_ms);
                // Convert back to days and return
                return Math.round(difference_ms / ONE_DAY);

            }

            function setShare(value) {
                var doc = document.getElementById("myPage:myForm:SelShare");
                doc.value = value;
            }

            mDaysInMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

            function daysInMonth(month, year) {
                if ((month == 1) && (year % 4 == 0) && ((year % 100 != 0) || (year % 400 == 0))) {
                    return 29;
                } else {
                    return mDaysInMonth[month];
                }
            }

            function IsDateEqual(Date1, Date2) {
                var DaysDiff;
                DaysDiff = Math.floor((Date1.getTime() - Date2.getTime()) / (1000 * 60 * 60 * 24));
                if (DaysDiff == 0)
                    return true;
                else
                    return false;
            }

            var position;

            function loadCx(proName, index) {

                position = index;
                var title = document.getElementById('InlineCopyDialogTitle');
                title.innerHTML = proName;
                var radioStr = '';
                var newdiv = document.getElementById('contentCopy');

                newdiv.innerHTML = '<tr><td>{!$Label.HowManyCopies}&nbsp;&nbsp;<input id="copies" name="copies" type="input"></td></tr>';
            }

            function editBlockOpenCx() {
                var divOverLay = document.getElementById('overlayBackground');
                var divObj = document.getElementById('InlineCopyDialog')
                divOverLay.style.display = 'inline';
                divObj.style.display = 'inline';
            }


            function loadRadio(proName, index) {
                index = checkCurrentPosition(index);
                position = index;
                var start = document.getElementById('myPage:myForm:MyPageBlock:myRepeat1:' + index + ':startDate').value;
                var end = document.getElementById('myPage:myForm:MyPageBlock:myRepeat1:' + index + ':endDate').value;
                var title = document.getElementById('InlineEditDialogTitle');
                title.innerHTML = proName;
                var radioStr = '';
                var newdiv = document.getElementById('content');

                if (start == '' || end == '') {

                    radioStr = '{!$Label.NoShare}';

                } else {

                    var temp1 = new Array();
                    if (start.indexOf('.') != -1) {
                        temp1 = start.split('.');
                    } else if (start.indexOf('/') != -1) {
                        temp1 = start.split('/');
                    }

                    var temp2 = new Array();
                    if (end.indexOf('.') != -1) {
                        temp2 = end.split('.');
                    } else if (end.indexOf('/') != -1) {
                        temp2 = end.split('/');
                    }

                    var startDate = new Date(temp1[2] + '/' + temp1[1] + '/' + temp1[0]);
                    var endDate = new Date(temp2[2] + '/' + temp2[1] + '/' + temp2[0]);

                    var lastDate;
                    var lastmonth = tmpStart;
                    radioStr = '<table>';
                    var lastSun;
                    var tmpStart = startDate;
                    var weeks = 0;
                    var weeks2 = 0;
                    var months = 0;
                    while (tmpStart <= endDate) {
                        if (tmpStart.getDay() == 0) {
                            weeks = weeks + 1;
                            lastSun = tmpStart;
                        }

                        lastDate = new Date(tmpStart.getFullYear(), tmpStart.getMonth(), daysInMonth((tmpStart.getMonth()), tmpStart.getFullYear()));
                        if (IsDateEqual(tmpStart, lastDate)) {
                            months = months + 1;
                            lastmonth = tmpStart;

                        }

                        tmpStart = new Date(tmpStart.getTime() + (24 * 60 * 60 * 1000));
                    }

                    if (lastmonth < endDate) {
                        months = months + 1;
                    }
                    if (lastSun < endDate) {
                        weeks = weeks + 1;
                    }
                    weeks2 = Math.ceil(weeks / 2);


                    if (weeks > 1) {
                        radioStr = radioStr + '<tr><td><input  name="group" type="radio" onclick="setShare(\'week\')"  />{!$Label.WeekShare} (' + weeks + ' {!$Label.Products})</input></td></tr>';
                    }
                    if (weeks2 > 1) {
                        radioStr = radioStr + '<tr><td><input  name="group" type="radio" onclick="setShare(\'week2\')"  />{!$Label.Week2Share} (' + weeks2 + ' {!$Label.Products})</input></td></tr>';
                    }


                    if (months > 1) {
                        radioStr = radioStr + '<tr><td><input  name="group" type="radio" onclick="setShare(\'month\')"   />{!$Label.MonthShare}  (' + months + ' {!$Label.Products})</input>  </td></tr>';
                    }
                    radioStr = radioStr + '</table>';
                    if (radioStr == '<table></table>') {
                        radioStr = '{!$Label.NoShare}';
                    }
                }
                newdiv.innerHTML = radioStr;


            }

            function setWidthDiv(val) {
                var mydiv = document.getElementById(val);
                mydiv.style.width = (getWidth() - 485) + 'px';
                //mydiv.style.word-wrap= 'break-word';

            }

            function editBlockOpen() {
                var divOverLay = document.getElementById('overlayBackground');
                var divObj = document.getElementById('InlineEditDialog');
                divOverLay.style.display = 'inline';
                divObj.style.display = 'inline';
            }

            function trim(str) {
                var reExtraSpace = /^\s+(.*?)\s+$/;
                str = str.replace(reExtraSpace, '$1');
                return str.replace(' ', '');
            }


            function checkCurrentPosition(p) {
                var maxRec = '{!MAXRECORD}';
                if (p > maxRec) {
                    var pn = document.getElementById('myPage:myForm:MyPageBlock:PageNum').value;
                    p = p - ((pn * maxRec) - maxRec);
                }
                return p;
            }


            function checkValidationCopyField(p, n, i) {
                p = checkCurrentPosition(p);
                var compo = document.getElementById('myPage:myForm:MyPageBlock:myRepeat' + i + ':' + p + ':' + n).value;
                //cut all space throw aways

                compo = trim(compo);

                if (compo != '') {
                    copyField();
                }
            }


            function checkValidationCopyField2(p, n, i) {
                p = checkCurrentPosition(p);

                var txtSP = document.getElementById('myPage:myForm:MyPageBlock:myRepeat' + i + ':' + p + ':' + n);
                if (txtSP.disabled == false) {
                    var compo = document.getElementById('myPage:myForm:MyPageBlock:myRepeat' + i + ':' + p + ':' + n).value;
                    //cut all space throw aways
                    compo = trim(compo);
                    //alert(compo);
                    if (compo != '') {
                        copyField();
                    }
                }
            }


            function forceCopyField(p, n, i) {
                p = checkCurrentPosition(p);
                var compo = document.getElementById('myPage:myForm:MyPageBlock:myRepeat' + i + ':' + p + ':' + n).value;
                //cut all space throw aways
                compo = trim(compo);
                //alert(compo);
                if (compo != '') {
                    forceCopyFieldCon();
                }

            }

            function forceCopyField2(p, n, i) {
                p = checkCurrentPosition(p);
                var txtSP = document.getElementById('myPage:myForm:MyPageBlock:myRepeat' + i + ':' + p + ':' + n);
                if (txtSP.disabled == false) {
                    var compo = document.getElementById('myPage:myForm:MyPageBlock:myRepeat' + i + ':' + p + ':' + n).value;
                    //cut all space throw aways
                    compo = trim(compo);
                    //alert(compo);
                    if (compo != '') {
                        forceCopyFieldCon();
                    }
                }
            }

            function checkValidationSplit() {
                var start = document.getElementById('myPage:myForm:MyPageBlock:myRepeat1:' + position + ':startDate').value;
                var end = document.getElementById('myPage:myForm:MyPageBlock:myRepeat1:' + position + ':endDate').value;
                if (start != '' && end != '') {
                    split();
                }
            }

            function checkValidationCopy() {
                try {
                    var copies = document.getElementById('copies').value;
                    if (copies != '' && copies > 0) {
                        var doc = document.getElementById("myPage:myForm:MyPageBlock:SelCopies");
                        doc.value = copies;
                        copy();
                    }
                } catch (e) {
                    alert(e);
                }
            }

            function isIE() {
                return /msie/i.test(navigator.userAgent) && !/opera/i.test(navigator.userAgent);
            }


            function getTargetingTreePopup(i, p, s) {
                p = checkCurrentPosition(p);
                openTargetingTreePopup(i, 'myPage:myForm:MyPageBlock:myRepeat6:' + p + ':hidTargetId', s)
            }

            function putAvailableSiteToFixedSite(p, isFix) {
                p = checkCurrentPosition(p);
                var avaiValue = '';
                avaiValue = document.getElementById('myPage:myForm:MyPageBlock:myRepeat6:' + p + ':hidAvail');
                var tarValue = document.getElementById('myPage:myForm:MyPageBlock:myRepeat6:' + p + ':txaTarget');
                if (tarValue.value == '' || tarValue.value == null) {
                    if (isFix == 'true') {
                        tarValue.value = avaiValue.value;
                    }
                }
            }

            function onload() {
                //alert('first: ' + window.screen.availWidth);

                var divOverLay = document.getElementById("myPage:myForm:MyPageBlock");
                var div1 = document.getElementById("mydev1");
                var div2 = document.getElementById("mydev2");
                var div3 = document.getElementById("mydev3");
                var div4 = document.getElementById("mydev4");
                var div5 = document.getElementById("mydev5");
                var div6 = document.getElementById("mydev6");
                var div7 = document.getElementById("mydev7");
                var div8 = document.getElementById("mydev8");
                var div9 = document.getElementById("mydev9");
                div1.style.width = (window.screen.availWidth - 465) + "px";
                div2.style.width = (window.screen.availWidth - 465) + "px";
                div3.style.width = (window.screen.availWidth - 465) + "px";
                div4.style.width = (window.screen.availWidth - 465) + "px";
                div5.style.width = (window.screen.availWidth - 465) + "px";
                div6.style.width = (window.screen.availWidth - 465) + "px";
                div7.style.width = (window.screen.availWidth - 465) + "px";
                div8.style.width = (window.screen.availWidth - 465) + "px";
                div9.style.width = (window.screen.availWidth - 465) + "px";
                divOverLay.style.width = (window.screen.availWidth - 63) + "px";
            }

            function mergeKVKW(p) {
                p = checkCurrentPosition(p);
                var kv = document.getElementById('myPage:myForm:MyPageBlock:myRepeat6:' + p + ':keyvalueString');
                var kw = document.getElementById('myPage:myForm:MyPageBlock:myRepeat4:' + p + ':keyword');
                var fk = document.getElementById('myPage:myForm:MyPageBlock:myRepeat9:' + p + ':finalKey');

                if (kv.value == '' || kv.value == null) {
                    fk.value = kw.value;
                } else if (kw.value == '' || kw.value == null) {
                    fk.value = kv.value;
                } else if (kv.value != '' && kv.value != null && kw.value != '' && kw.value != null) {
                    fk.value = '(' + kv.value + ') AND (' + kw.value + ')';
                }
            }

            function disableInputField(p, typeOfField, idField, repeatNum) {
                p = checkCurrentPosition(p);
                var c = document.getElementById('myPage:myForm:MyPageBlock:' + repeatNum + ':' + p + ':' + idField);
                if (typeOfField == 'false') {
                    c.disabled = true;
                }
            }

            function visibleSpinner(val, gbpId, spinnerId) {
                var elem_gbp = document.getElementById(gbpId);
                var elem_percent = document.getElementById(spinnerId);

                elem_gbp.style.display = (val == '{!GBP_TYPE}' ? '' : 'none');
                elem_percent.style.display = (val == '{!PERCENT_TYPE}' ? '' : 'none');
            }

            function fillValue2Spinner(val, spinnerId, index) {
                document.getElementById(spinnerId).value = val;
            }
        </script>
    </head>
    <div class="bPageTitle">
        <div class="ptBody secondaryPalette">
            <div class="content">
                <apex:image id="theImage" value="/s.gif" styleClass="pageTitleIcon" />
                <apex:outputPanel >
                     <h2 class="pageType"><apex:outputText value="Opportunity Name: {!mcName}"/></h2>

                     <h1 class="pageDescription"><apex:outputText value="Account Name: {!accName}"/></h1>

                </apex:outputPanel>
            </div>
        </div>
    </div>
    <apex:form id="myForm">
        <apex:InputHidden id="SelPosition" value="{!selPosition}" />
        <apex:InputHidden id="SelColumn" value="{!selColumn}" />
        <apex:InputHidden id="SelShare" value="{!selShare}" />
        <apex:InputHidden id="uAgent" value="{!hsize}" />
        <apex:InputHidden id="prodcount" value="{!prodcount}" />
        <apex:actionFunction name="saveRecord" action="{!saveRecords}" rerender="MyPageBlock" status="status" />
        <apex:actionFunction name="copyField" action="{!copyField}" rerender="MyPageBlock" status="status" />
        <apex:actionFunction name="forceCopyFieldCon" action="{!forceCopyField}" rerender="MyPageBlock" status="status" />
        <apex:actionFunction name="copy" action="{!copyRecords}" rerender="MyPageBlock" status="status" />
        <apex:actionFunction name="doCalculateNetNetNet" action="{!calculateNetNetNet}" rerender="theTabPanel" status="status" />
        <apex:pageBlock id="MyPageBlock" title="{!$Label.BlockTitle}" helptitle="Product configurator tips" helpUrl="https://c.eu0.content.force.com/servlet/servlet.FileDownload?file=01520000001wvfo">
            <apex:InputHidden id="SelCopies" value="{!selCopies}" />
            <apex:inputHidden value="{!pageNum}" id="PageNum" />
            <!-- Use for tooltip on product name -->
            <apex:outputPanel layout="block" style="z-index:10000;" id="thePanel2">
                <apex:outputLabel id="theLabel2" /></apex:outputPanel>
            <apex:pageBlockButtons >
                <apex:commandButton value="{!$Label.Save}" title="{!$Label.Save}" action="{!saveRecords}" rerender="MyPageBlock" status="status" />
                <apex:commandButton value="{!$Label.Back}" title="{!$Label.Back}" action="{!goBack}" immediate="true" rerender="MyPageBlock" status="status" />
                <apex:commandButton value="Clear all" title="Clear all" onClick="window.location='{!refreshUrl}';return false;" />
                
                <apex:commandButton value="Calculate all" title="Calculate all" action="{!reCalculateAll}" rerender="theTabPanel" status="status" />
            </apex:pageBlockButtons>
            <div class="pbSubheader first tertiaryPalette"> 
                    <span class="pbSubExtra"><nobr>
                        <span class="requiredLegend">
                            <span class="requiredExampleOuter">
                                <span class="requiredExample">&nbsp; </span>
                            </span> 
                            <span class="requiredMark">*</span>  
                            <span class="requiredText"> = Required Information</span>
                        </span>
                    </nobr>
                    </span>
                 <h3>
                Information             
                </h3> 
            </div>
            
            <apex:pageMessage severity="warning" summary="{!warningOli}" rendered="{!If(warningOli<> '' , true, false)}" strength="3"></apex:pageMessage>
            <apex:pageMessage severity="error" summary="{!errorMsg}" rendered="{!If(errorMsg<>'',true,false)}" strength="3"></apex:pageMessage>
            
            <apex:InputHidden id="fromDateStatus" value="{!fromDateError}" />
            <apex:InputHidden id="forceSave" value="{!forceDateSave}" />
            <apex:InputHidden id="errorField" value="{!errorFieldStatus}" />
            <apex:InputHidden id="BPCollision" value="{!BP_Collision}" />
            
            <script type="text/javascript">
                //call when got error from date < today
                var fromDate = document.getElementById("myPage:myForm:MyPageBlock:fromDateStatus").value;
                var forceSave = document.getElementById("myPage:myForm:MyPageBlock:forceSave");
                var errorField = document.getElementById("myPage:myForm:MyPageBlock:errorField").value;
                var BPCollision = document.getElementById("myPage:myForm:MyPageBlock:BPCollision").value;

                if (fromDate == 'true' && errorField == 'false') {
                    var ans;
                    ans = window.confirm('{!$Label.Error_date}');


                    if (ans == true) {
                        forceSave.value = true;
                        saveRecords();
                    }

                } else if (BPCollision != '') {
                    window.alert('Belegungsplan Kollision\n\n' + BPCollision);
                    forceSave.value = true;
                    saveRecord();
                }
            </script>
            
            <div style="overflow: hidden" id="divtab">
                <table cellpadding="0" cellspacing="0" width="100%">
                    <tr style="vertical-align:top">
                        <td width="20%">
                            <table style="margin-top:24px;background-color:#F3F3EC" cellpadding="0" cellspacing="0" width="370px">
                                <tr style="height:{!hsize}" id="header">
                                    <td align="center" style="font-weight:bold;border-bottom:1px solid #E3DEB8;">{!$Label.Product_Name}</td>
                                    <td align="center" style="font-weight:bold;border-bottom:1px solid #E3DEB8;">&nbsp;</td>
                                </tr>
                                <!-- <apex:repeat value="{!lstRecords}" var="rec"> -->
                                <apex:repeat value="{!lDisplayRec}" var="rec">
                                    <!-- <apex:repeat value="{!mapContentRecords[pageNum]}" var="rec">-->
                                    <tr style="height:84px">
                                        <td width="280px" style="border-bottom:1px solid #E3DEB8;white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word;">
                                            <apex:outputLabel id="proName" value="{!rec.position+1}) {!rec.productName}" onmouseout="closeMessage('myPage:myForm:MyPageBlock:thePanel2');" onmouseover="changeTextValue('{!$ObjectType.OpportunityLineItem.Fields.Description.label}: {!rec.descr} \n {!$ObjectType.OpportunityLineItem.Fields.from_Date__c.label}: {!rec.fromDate} \n {!$ObjectType.OpportunityLineItem.Fields.until_Date__c.label}: {!rec.untilDate} \n {!$ObjectType.OpportunityLineItem.Fields.Quantity.label}: {!rec.quantity} \n {!$ObjectType.OpportunityLineItem.Fields.Targeting__c.label}: {!rec.targeting_c}','myPage:myForm:MyPageBlock:theLabel2','myPage:myForm:MyPageBlock:thePanel2',0,20);"
                                            styleclass="mousehover"></apex:outputLabel>
                                        </td>
                                        <td align="center" style="border-bottom:1px solid #E3DEB8; " width="90px">
                                            <apex:commandButton value="{!$Label.K}" action="{!duplicateRecord}" rerender="MyPageBlock" status="status" title="{!$Label.DuplicationItem}">
                                                <apex:param name="selPosition" value="{!rec.position}" assignTo="{!selPosition}" />
                                            </apex:commandButton>
                                            <apex:commandButton value="{!$Label.Kx}" onmouseover="setPosition('{!rec.position}');" onclick="loadCx('{!rec.productName}','{!rec.position}');editBlockOpenCx();return false;" title="{!$Label.DuplicationXItem}" />
                                            <br/>
                                            <apex:commandButton value="{!$Label.L}" action="{!deleteRecord}" rerender="MyPageBlock" status="status" title="{!$Label.DeleteItem}">
                                                <apex:param name="selPosition" value="{!rec.position}" assignTo="{!selPosition}" />
                                            </apex:commandButton>
                                            <apex:commandButton value="{!$Label.V}" onmouseover="setPosition('{!rec.position}');" onclick="loadRadio('{!rec.productName}','{!rec.position}');editBlockOpen();return false;" title="{!$Label.SplitItem}" />
                                        </td>
                                    </tr>
                                </apex:repeat>
                            </table>
                        </td>
                        <td width="80%">
                            <apex:tabPanel switchType="client" selectedTab="name1" id="theTabPanel" style="padding:0px;margin:0px;border:0px;" inactiveTabClass="inactiveTab" immediate="false" tabClass="cursor:hand" value="{!ActiveTab}">
                                <!-- Period Tab -->
                                <apex:tab label="{!$Label.Tab1}" name="name1" id="tabOne" style="padding:0px;margin:0px;border:0px;background-color:#F3F3DC;">
                                    <div style="overflow-x: auto;overflow-y:auto;border:0px;padding:0px;margin:0px;" id="mydev1">
                                        <table cellpadding="0" cellspacing="0" width="100%">
                                            <tr id="tab1" style="height:64px;border-bottom:1px solid #E3DEB8;background-color:#F3F3EC">
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="{!$ObjectType.OpportunityLineItem.Fields.Description.label}" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="{!$ObjectType.OpportunityLineItem.Fields.from_Date__c.label}" style="color: #CC0000;" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="{!$ObjectType.OpportunityLineItem.Fields.until_Date__c.label}" style="color: #CC0000;" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="Length (months)" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="Extra (days)" />
                                                </td>
                                                <td class="colContent">&nbsp;</td>
                                            </tr>
                                            <apex:repeat value="{!lDisplayRec}" var="rec" id="myRepeat1">
                                                <tr style="height:84px">
                                                    <td align="center" class="colContent" style="padding-left: 5px;">
                                                        <div>
                                                            <apex:inputTextArea cols="40" rows="2" value="{!rec.item.Description}" id="LineDescription" />
                                                        </div>
                                                        <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','LineDescription','1');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Description')" style="margin-top:2px">
                                                            <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                        <apex:commandLink onclick="forceCopyField('{!rec.position}','LineDescription','1');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Description')" style="margin-top:2px">
                                                            <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                    </td>
                                                    <td align="center" class="colContent" style="padding-left: 5px;" width="125px">
                                                        <div class="requiredExample" style="text-align:left;"><span style="width:2px;"></span> 
                                                            <apex:inputField value="{!rec.item.from_Date__c}" id="startDate" required="false" style="padding-left: 2px;width:125px;" />
                                                            <!-- onChange="change_fromdate('{!rec.position}');" -->
                                                        </div>
                                                        <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','startDate','1');return false;" onmouseover="setPosition('{!rec.position}');setColumn('from_Date__c')" style="margin-top:2px">
                                                            <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                        <apex:commandLink onclick="forceCopyField('{!rec.position}','startDate','1');return false;" onmouseover="setPosition('{!rec.position}');setColumn('from_Date__c')" style="margin-top:2px">
                                                            <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                    </td>
                                                    <td align="center" class="colContent" style="padding-left: 5px;" width="125px">
                                                        <div class="requiredExample" style="text-align:left;"><span style="width:2px;"></span>

                                                            <apex:inputField value="{!rec.item.until_Date__c}" id="endDate" required="false" style="padding-left: 2px;width:125px;" onClick="setToDate('{!rec.position}')" />
                                                        </div>
                                                        <script>
                                                            disableInputField('{!rec.position}', '{!rec.pro.ManualSetEndDate__c}', 'endDate', 'myRepeat1');
                                                        </script>
                                                        <div style="{!If(rec.pro.ManualSetEndDate__c == true, '', 'display:none;')}">
                                                            <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','endDate','1');return false;" onmouseover="setPosition('{!rec.position}');setColumn('until_Date__c')" style="margin-top:2px">
                                                                <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                            <apex:commandLink onclick="forceCopyField('{!rec.position}','endDate','1');return false;" onmouseover="setPosition('{!rec.position}');setColumn('until_Date__c')" style="margin-top:2px">
                                                                <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                        </div>
                                                    </td>
                                                    <td align="center" style="padding-left: 5px; width:100px;" class="colContent">
                                                        <div>
                                                            <apex:inputField value="{!rec.item.Length_Months__c}" id="Length" style="width:100px"/>
                                                        </div>
                                                        <script>
                                                            disableInputField('{!rec.position}', '{!rec.pro.MonthsDays__c}', 'Length', 'myRepeat1');
                                                        </script>
                                                        <div style="{!If(rec.pro.MonthsDays__c == true, '', 'display:none;')}">
                                                            <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','Length','1');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Length_Months__c')" style="margin-top:2px;">
                                                                <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                            <apex:commandLink onclick="forceCopyField('{!rec.position}','Length','1');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Length_Months__c')" style="margin-top:2px;">
                                                                <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                        </div>
                                                    </td>
                                                    <td align="center" style="padding-left: 5px;width:100px;" class="colContent">
                                                        <div>
                                                            <apex:inputField value="{!rec.item.Additional_Time_Days__c}" id="Extra" style="width:100px" />
                                                        </div>
                                                        <script>
                                                            disableInputField('{!rec.position}', '{!rec.pro.MonthsDays__c}', 'Extra', 'myRepeat1');
                                                        </script>
                                                        <div style="{!If(rec.pro.MonthsDays__c == true, '', 'display:none;')}">
                                                            <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','Extra','1');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Additional_Time_Days__c')" style="margin-top:2px;">
                                                                <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                            <apex:commandLink onclick="forceCopyField('{!rec.position}','Extra','1');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Additional_Time_Days__c')" style="margin-top:2px;">
                                                                <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                        </div>
                                                    </td>
                                                    <td class="colContent">&nbsp;</td>
                                                </tr>
                                            </apex:repeat>
                                        </table>
                                    </div>
                                    <script>
                                        // setWidthDiv('mydev1');
                                    </script>
                                </apex:tab>
                                <!-- End Period Tab -->
                                <!-- Pricing Tab -->
                                <apex:tab label="{!$Label.Tab2}" name="name2" id="tabTwo" style="padding:0px;margin:0px;border:0px;background-color:#F3F3DC;">
                                    <div style="overflow-x: auto;overflow-y:auto;border:0px;padding:0px;margin:0px;" id="mydevPrice">
                                        <table cellpadding="0" cellspacing="0" width="1000px">
                                            <tr id="tab2" style="height:64px;border-bottom:1px solid #E3DEB8;background-color:#F3F3EC">
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="{!$ObjectType.OpportunityLineItem.Fields.Billing_Category__c.label}" style="color: #CC0000;" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="{!$ObjectType.OpportunityLineItem.Fields.Quantity.label}" style="color: #CC0000;" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="{!$ObjectType.OpportunityLineItem.Fields.UnitPrice.label}" style="color: #CC0000;" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="Surcharge" />
                                                    <br/>
                                                    <apex:outputText value="+ %" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="Discount" />
                                                    <br/>
                                                    <apex:outputText value="- %" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="Sales Price" />
                                                    <br/>
                                                    <apex:outputText value="Target" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="{!$ObjectType.OpportunityLineItem.Fields.AE__c.label}" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="Net/Net/Net" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="Budget" />
                                                    <br/>
                                                    <apex:outputText value="Net/Net/Net" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="Discount reason" />
                                                </td>
                                                <td class="colHeader">&nbsp;</td>
                                            </tr>
                                            <apex:repeat value="{!lDisplayRec}" var="rec" id="myRepeat2">
                                                <tr style="height:84px;background-color:#F3F3DC" class="multiSelectPicklistRow">
                                                
                                                    <!-- Billing Category -->
                                                    <td align="center" class="colContent" style="padding-left: 10px;width:80px;">
                                                        <!-- apex:outputText rendered="{!if(rec.item.PricebookEntry.Product2.Variable_CPM_price__c || Not(isEdit),true,false)}" -->
                                                        <apex:outputText >
                                                            <!-- rendered="{!rec.item.PricebookEntry.Product2.Variable_CPM_price__c}" -->
                                                            <table cellpadding="0" cellspacing="0" width="100%" border="0">
                                                                <tr>
                                                                    <td>
                                                                        <div class="requiredExample" style="text-align:left;"><span style="width:2px;"></span> 
                                                                            <!-- apex:inputField id="BillingCategory" value="{!rec.item.Billing_category__c}" rendered="{!if(rec.item.PricebookEntry.Product2.Variable_CPM_price__c || Not(isEdit),true,false)}" onChange="changeBC('{!rec.position}','{!rec.item.PricebookEntry.Product2.Fixed_price__c}')"
                                                                            required="false"/ -->
                                                                            <!-- <apex:inputField id="BillingCategory" value="{!rec.item.Billing_category__c}" onChange="changeBC('{!rec.position}','{!rec.item.PricebookEntry.Product2.Fixed_price__c}')" required="false" style="width:100%"/>-->
                                                                            <apex:selectList id="BillingCategory" styleClass="{!If(rec.errBillin == '', '',If(isSave == true,'error',''))}" value="{!rec.billingCategory2}" multiselect="false" Size="1" onChange="changeBC('{!rec.position}','{!rec.item.PricebookEntry.Product2.Fixed_price__c}')"
                                                                            required="false" style="width:100%">
                                                                                <apex:selectOptions value="{!rec.listBilling}"></apex:selectOptions>
                                                                            </apex:selectList>
                                                                            <div class="errorMsg" style="{!If(rec.errBillin == '', 'display:none;',If(isSave == true,'','display:none'))}"><strong>Error:</strong> {!rec.errBillin}</div>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td align="center">
                                                                        <!-- apex:commandLink action="{!copyField}" rerender="MyPageBlock" status="status" style="margin-top:2px" rendered="{!if(rec.item.PricebookEntry.Product2.Variable_CPM_price__c || Not(isEdit),true,false)}" -->
                                                                        <apex:commandLink action="{!copyField}" rerender="MyPageBlock" status="status" style="margin-top:2px">
                                                                            <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" />
                                                                            <apex:param name="selPosition" value="{!rec.position}" assignTo="{!selPosition}" />
                                                                            <apex:param name="selColumn" value="Billing_category__c" assignTo="{!selColumn}" />
                                                                        </apex:commandLink> 
                                                                        
                                                                        <span></span>

                                                                        <apex:commandLink action="{!forceCopyField}" rerender="MyPageBlock" status="status" style="margin-top:2px">
                                                                            <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" />
                                                                            <apex:param name="selPosition" value="{!rec.position}" assignTo="{!selPosition}" />
                                                                            <apex:param name="selColumn" value="Billing_category__c" assignTo="{!selColumn}" />
                                                                        </apex:commandLink>
                                                                    </td>
                                                                </tr>
                                                            </table>
                                                        </apex:outputText>
                                                        <!-- apex:outputText rendered="{!if(Not(rec.item.PricebookEntry.Product2.Variable_CPM_price__c) && isEdit,true,false)}" -->
                                                        <!-- <apex:outputText rendered="{!!rec.item.PricebookEntry.Product2.Variable_CPM_price__c}">
                                                                                            <div class="visibleDiv" ><apex:outputtext value="{!rec.item.Billing_category__c}"  /></div>
                                                                                             <apex:image value="{!$Resource.Copy}" />
                                                                                             
                                                                           </apex:outputText> 
                                                                       -->
                                                    </td>
                                                    <!-- QTY -->
                                                    <td align="center" style="padding-left: 10px;width:70px;" class="colContent">
                                                        <table cellpadding="0" cellspacing="0" width="100%" border="0">
                                                            <tr>
                                                                <td>
                                                                    <div class="requiredExample" style="text-align:left;"><span style="width:2px;"></span> 
                                                                        <apex:inputText styleClass="{!If(rec.errQty == '', '',If(isSave == true,'error',''))}" value="{!rec.quantity}" required="false" id="Quantity" style="padding-left: 2px;width:70px;"></apex:inputText>
                                                                        <div class="errorMsg" style="{!If(rec.errQty == '', 'display:none;',If(isSave == true,'','display:none'))}"><strong>Error:</strong> {!rec.errQty}</div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td align="center">
                                                                    <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','Quantity','2');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Quantity')" style="margin-top:2px">
                                                                        <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                                    <apex:commandLink onclick="forceCopyField('{!rec.position}','Quantity','2');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Quantity')" style="margin-top:2px">
                                                                        <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <!-- sale price (unitPrice) -->
                                                    <td align="center" style="padding-left: 10px;width:70px;" class="colContent">
                                                        <!-- For the billing category “CPM” the sales price should not be editable. For all other billing categories the sales price is editable if at the product fix_price__c=t rue than the sales price within the visualforce page should not be editable, but
                                                        in case that the user choose the billing category "CPC" or "CPO" at the visualforce page, than the price should be editable -->
                                                        <apex:outputText >
                                                            <table cellpadding="0" cellspacing="0" width="100%" border="0">
                                                                <tr>
                                                                    <td>
                                                                        <div class="requiredExample" style="text-align:left;"><span style="width:2px;"></span>

                                                                            <apex:inputText styleClass="{!If(rec.errSalePrice == '', '',If(isSave == true,'error',''))}" value="{!rec.item.UnitPrice}" id="Sales_Price" style="width:70px;" />
                                                                            <div class="errorMsg" style="{!If(rec.errSalePrice == '' , 'display:none;', If(isSave == true,'','display:none'))}"><strong>Error:</strong> {!rec.errSalePrice}</div>
                                                                            <script>
                                                                                var sp = document.getElementById('{!$Component.Sales_Price}');
                                                                                if ('{!rec.item.PricebookEntry.Product2.Fixed_price__c}' == 'true') {
                                                                                    sp.disabled = true;
                                                                                }
                                                                            </script>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td align="center">
                                                                        <div style="{!If(rec.pro.Fixed_price__c == false, '', 'display:none;')}">
                                                                            <apex:commandLink onclick="checkValidationCopyField2('{!rec.position}','Sales_Price','2');return false;" onmouseover="setPosition('{!rec.position}');setColumn('UnitPrice')">
                                                                                <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span> 
                                                                            <apex:commandLink onclick="forceCopyField2('{!rec.position}','Sales_Price','2');return false;" onmouseover="setPosition('{!rec.position}');setColumn('UnitPrice')">
                                                                                <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                                        </div>
                                                                        <div style="{!If(rec.pro.Fixed_price__c == true, '', 'display:none;')}">&nbsp;</div>
                                                                    </td>
                                                                </tr>
                                                            </table>
                                                        </apex:outputText>
                                                    </td>
                                                    <!-- Surcharge -->
                                                    <td align="center" class="colContent" style="padding-left: 5px; width:80px;">
                                                        <table cellpadding="0" cellspacing="0" width="100%" border="0">
                                                            <tr>
                                                                <td align="center">
                                                                    <!-- Type surcharge -->
                                                                    <apex:outputPanel id="panelSurcharge">
                                                                        <apex:inputHidden value="{!rec.item.Targeting_Surcharge__c}" id="Surcharge" /></apex:outputPanel>
                                                                    <apex:outputPanel id="panelSurchargeSpinner">
                                                                        <input id="spinner{!rec.position}" style="width:40px" value="{!rec.item.Targeting_Surcharge__c}" />
                                                                        <script>
                                                                            jq("#spinner{!rec.position}").spinner({
                                                                                    max: 100,
                                                                                    min: 0,
                                                                                    change: function (event, ui) {
                                                                                        var elem_surcharge = document.getElementById('myPage:myForm:MyPageBlock:myRepeat2:{!rec.position}:Surcharge');
                                                                                        elem_surcharge.value = this.value;
                                                                                    }
                                                                                });

                                                                            
                                                                        </script>
                                                                    </apex:outputPanel>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td align="center">
                                                                    <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','Surcharge','2');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Targeting_Surcharge__c')" style="margin-top:2px">
                                                                        <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                                    <apex:commandLink onclick="forceCopyField('{!rec.position}','Surcharge','2');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Targeting_Surcharge__c')" style="margin-top:2px">
                                                                        <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <!-- Discount -->
                                                    <td align="center" class="colContent" style="padding-left: 5px; width:80px;">
                                                        <!-- Type discount -->
                                                        <apex:outputPanel id="panelDiscount">
                                                            <apex:inputHidden value="{!rec.item.Rate_Discount_II__c}" id="Discount" />
                                                                <!-- <apex:actionSupport event="onchange" action="{!calculateDiscountPrice}" rerender="DiscountPrice">
                                                                                <apex:param name="selectedRandomNr" value="{!rec.randomNr}" assignTo="{!selectedRandomNr}"/>
                                                                            </apex:actionSupport>-->
                                                        </apex:outputPanel>
                                                        <apex:outputPanel id="panelDiscountSpinner">
                                                            <input id="spinnerDiscount{!rec.position}" style="width:40px" value="{!rec.item.Rate_Discount_II__c}" />
                                                            <script>
                                                                jq("#spinnerDiscount{!rec.position}").spinner({
                                                                        max: 100,
                                                                        min: 0,
                                                                        change: function (event, ui) {
                                                                            var elem_discount = document.getElementById('myPage:myForm:MyPageBlock:myRepeat2:{!rec.position}:Discount');
                                                                            elem_discount.value = this.value;
                                                                        }
                                                                    });

                                                                
                                                            </script>
                                                        </apex:outputPanel>
                                                        <br/>
                                                        <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','Discount','2');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Rate_Discount_II__c')" style="margin-top:2px">
                                                            <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                        <apex:commandLink onclick="forceCopyField('{!rec.position}','Discount','2');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Rate_Discount_II__c')" style="margin-top:2px">
                                                            <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                    </td>
                                                    <!-- Sales Price Target -->
                                                    <td align="center" class="colContent" style="padding-left: 5px; width: 70px;">
                                                        <apex:inputField value="{!rec.item.Sales_Price_Target__c}" id="Target" style="width:70px;"></apex:inputField>
                                                        <br/>
                                                        <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','Target','2');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Sales_Price_Target__c')" style="margin-top:2px">
                                                            <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                        <apex:commandLink onclick="forceCopyField('{!rec.position}','Target','2');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Sales_Price_Target__c')" style="margin-top:2px">
                                                            <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                    </td>
                                                    <!-- Agency Commission -->
                                                    <td align="center" style="padding-left: 5px;width:35px;" class="colContent">
                                                        <apex:inputField value="{!rec.item.AE__c}" id="AE" style="width:35px;"></apex:inputField>
                                                        <br/>
                                                        <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','AE','2');return false;" onmouseover="setPosition('{!rec.position}');setColumn('AE__c')" style="margin-top:2px">
                                                            <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                        <apex:commandLink onclick="forceCopyField('{!rec.position}','AE','2');return false;" onmouseover="setPosition('{!rec.position}');setColumn('AE__c')" style="margin-top:2px">
                                                            <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                    </td>
                                                    <!-- Net/Net/Net -->
                                                    <td align="center" class="colContent" style="padding-left: 5px; width: 75px;">
                                                        <table cellpadding="0" cellspacing="0" width="100%" border="0">
                                                            <tr>
                                                                <td>
                                                                    <div style="text-align:left;"><span style="width:2px;"></span>

                                                                        <apex:inputText value="{!rec.item.Net_Net_Net__c}" id="NNN" style="width:75px;" />
                                                                        <script>
                                                                            var index = checkCurrentPosition('{!rec.position}');
                                                                            var sp = document.getElementById('myPage:myForm:MyPageBlock:myRepeat2:' + index + ':NNN');
                                                                            if ('{!rec.item.PricebookEntry.Product2.Fixed_price__c}' == 'true') {
                                                                                sp.disabled = true;
                                                                            }
                                                                        </script>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td align="center">&nbsp;</td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <!-- Net/Net/Net Target -->
                                                    <td align="center" class="colContent" style="padding-left: 5px; width: 75px;">
                                                        <apex:inputField value="{!rec.item.Budget_NetNetNet__c}" id="NNNTarget" style="width:75px;"></apex:inputField>
                                                        <br/>
                                                        <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','NNNTarget','2');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Budget_NetNetNet__c')" style="margin-top:2px">
                                                            <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                        <apex:commandLink onclick="forceCopyField('{!rec.position}','NNNTarget','2');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Budget_NetNetNet__c')" style="margin-top:2px">
                                                            <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                    </td>
                                                    <!-- Discount Reason -->
                                                    <td align="center" style="padding-left: 5px;width:120px;" class="colContent">
                                                        <apex:inputField value="{!rec.item.Rebate_In_Kind_Reason__c}" id="GD1" style="" />
                                                        <br/>
                                                        <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','GD1','2');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Rebate_In_Kind_Reason__c')" style="margin-top:2px">
                                                            <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                        <apex:commandLink onclick="forceCopyField('{!rec.position}','GD1','2');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Rebate_In_Kind_Reason__c')" style="margin-top:2px">
                                                            <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                    </td>
                                                    <td class="colContent">&nbsp;</td>
                                                </tr>
                                            </apex:repeat>
                                        </table>
                                    </div>
                                    <script>
                                        // setWidthDiv('mydev1');
                                    </script>
                                </apex:tab>
                                <!-- End Pricing Tab -->
                                <!-- New Request -->
                                <!-- Detail-Targeting Tab-->
                                <apex:tab label="{!$Label.Tab6}" name="tabname6" id="tabname6" style="padding:0px;margin:0px;border:0px;background-color:#F3F3DC">
                                    <div style="padding:0px;margin:0px;border:0px solid;overflow-x: auto;overflow-y:hidden;" id="mydev6">
                                        <table cellpadding="0" cellspacing="0" width="100%">
                                            <tr id="tab1" style="height:64px;border-bottom:1px solid #E3DEB8;background-color:#F3F3EC">
                                                <td align="center" class="colHeader" width="60px">&nbsp;</td>
                                                <td align="center" class="colHeader" width="427px">
                                                    <apex:outputText value="Category Targeting" />
                                                </td>
                                                <!-- value=" {!$ObjectType.OpportunityLineItem.Fields.Rich_Line_Description__c.label}" -->
                                                <td align="center" class="colHeader" width="427px">
                                                    <apex:outputText value="{!$ObjectType.OpportunityLineItem.Fields.KeyValueString__c.label}" />
                                                </td>
                                                <td class="colHeader" width="127px">&nbsp;</td>
                                            </tr>
                                            <!-- <apex:repeat value="{!lstRecords}" var="rec" id="myRepeat6"> -->
                                            <apex:repeat value="{!lDisplayRec}" var="rec" id="myRepeat6">
                                                <tr style="height:84px">
                                                    <td align="center" class="colContent" style="padding-left: 5px;" width="60px">
                                                        <apex:inputHidden value="{!rec.item.Targeting__c}" id="hidTargetId" />
                                                        <apex:inputHidden value="{!rec.proId}" id="hidProId" />
                                                        <apex:inputHidden value="{!rec.availableSite}" id="hidAvail" />
                                                        <apex:inputHidden value="{!rec.availableKV}" id="hidAvaiKV" />
                                                    </td>
                                                    <td align="center" class="colContent" style="padding-left: 5px;" width="427px">
                                                        <table cellspacing="0" cellpadding="0">
                                                            <tr>
                                                                <td>
                                                                    <!-- <apex:commandButton id="btnTarget" value="Select" onclick="openTargetingTreePopup(this.id,'myPage:myForm:MyPageBlock:myRepeat6:{!rec.position}:hidTargetId','TargetingButton'); return false;"/>-->
                                                                    <apex:commandButton rendered="{!IF(rec.isFixedSite==true, false, IF(rec.isHasSite == true, true, false))}" id="btnTarget" value="Select" onclick="getTargetingTreePopup(this.id,{!rec.position},'TargetingButton'); return false;" />
                                                                    <apex:inputHidden value="{!rec.item.Rich_Line_Description__c}" id="txaTarget_hid" />
                                                                </td>
                                                                <td>
                                                                    <table cellspacing="0" cellpadding="0">
                                                                        <tr>
                                                                            <td>
                                                                                <apex:inputTextArea disabled="{!IF(rec.isFixedSite == true, true, IF(rec.isHasSite == true, true, true))}" id="txaTarget" value="{!rec.item.Rich_Line_Description__c}" cols="48" rows="4" style="vertical-align:middle;" />
                                                                                <script>
                                                                                    putAvailableSiteToFixedSite('{!rec.position}', '{!rec.isFixedSite}');
                                                                                </script>
                                                                            </td>
                                                                            <td>
                                                                                <div style="{!IF(rec.isFixedSite==true, 'display:none;', IF(rec.isHasSite == true, '', 'display:none;'))}">
                                                                                    <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','txaTarget','6');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Rich_Line_Description__c')" style="margin-top:2px;padding-left:5px">
                                                                                        <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span> 
                                                                                    <apex:commandLink onclick="forceCopyField('{!rec.position}','txaTarget','6');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Rich_Line_Description__c')" style="margin-top:2px;padding-left:5px">
                                                                                        <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td align="center" class="colContent" style="padding-left: 5px;" width="427px">
                                                        <table cellspacing="0" cellpadding="0">
                                                            <tr>
                                                                <td width="40px">
                                                                    <!-- <apex:commandButton id="btnKeyValue" value="Key Value" onclick="openTargetingTreePopup(this.id,'myPage:myForm:MyPageBlock:myRepeat6:{!rec.position}:hidTargetId','KeyValueButton'); return false;"/>-->
                                                                    <apex:commandButton rendered="{!rec.isHasPreDefine}" id="btnKeyValue" value="Select" onclick="getTargetingTreePopup(this.id,{!rec.position},'KeyValueButton'); return false;" />
                                                                </td>
                                                                <td>
                                                                    <apex:inputTextArea disabled="{!IF(rec.isHasPreDefine== true, false, true)}" id="keyvalueString" value="{!rec.item.KeyValueString__c}" cols="48" rows="4" style="vertical-align:middle;" onchange="mergeKVKW('{!rec.position}')" />
                                                                </td>
                                                                <td style="{!IF(rec.isHasPreDefine== true, '', 'display:none;')}" width="20px">
                                                                    <table style="display:none;">
                                                                        <tr>
                                                                            <td>
                                                                                <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','keyvalueString','6');return false;" onmouseover="setPosition('{!rec.position}');setColumn('KeyValueString__c')" style="margin-top:2px;padding-left:5px">
                                                                                    <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink>
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>
                                                                                <apex:commandLink onclick="forceCopyField('{!rec.position}','keyvalueString','6');return false;" onmouseover="setPosition('{!rec.position}');setColumn('KeyValueString__c')" style="margin-top:2px;padding-left:5px">
                                                                                    <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                </tr>
                                            </apex:repeat>
                                        </table>
                                    </div>
                                    <script>
                                        $$('table.multiSelectPicklistTable tr.multiSelectPicklistRow select').each(function (i) {
                                                i.style.height = "55px";
                                                i.style.width = "130px";
                                            });
                                         //setWidthDiv('mydev2');
                                    </script>
                                </apex:tab>
                                <!-- Frequency Capping Tab -->
                                <apex:tab label="{!$Label.Tab3}" name="name3" id="tabThree" style="padding:0px;margin:0px;border:0px;background-color:#F3F3DC">
                                    <div style="padding:0px;margin:0px;border:0px solid;overflow-x: auto;overflow-y:hidden;" id="mydev3">
                                        <table cellpadding="0" cellspacing="0" width="100%">
                                            <tr id="tab3" style="height:64px;border-bottom:1px solid #E3DEB8;background-color:#F3F3EC">
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="{!$ObjectType.OpportunityLineItem.Fields.Check_Inventory__c.label}" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="{!$ObjectType.OpportunityLineItem.Fields.FC_Quantity__c.label}" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="{!$ObjectType.OpportunityLineItem.Fields.FC_Ad_served_every__c.label}" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="{!$ObjectType.OpportunityLineItem.Fields.FC_Period__c.label}" />
                                                </td>
                                                <td class="colHeader">&nbsp;</td>
                                            </tr>
                                            <!-- <apex:repeat value="{!lstRecords}" var="rec" id="myRepeat3"> -->
                                            <apex:repeat value="{!lDisplayRec}" var="rec" id="myRepeat3">
                                                <tr style="height:84px;background-color:#F3F3DC" class="multiSelectPicklistRow">
                                                    <td align="center" class="colContent" style="padding-left: 2px;" width="80px">
                                                        <apex:inputField value="{!rec.item.Check_Inventory__c}" id="Check_inventory" />
                                                        <script>
                                                            disableInputField('{!rec.position}', '{!rec.pro.FC__c}', 'Check_inventory', 'myRepeat3');
                                                        </script>
                                                        <div style="{!If(rec.pro.FC__c == true, '', 'display:none;')}">
                                                            <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','Check_inventory','3');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Check_Inventory__c')" style="margin-top:2px;">
                                                                <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                            <apex:commandLink onclick="forceCopyField('{!rec.position}','Check_inventory','3');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Check_Inventory__c')" style="margin-top:2px;">
                                                                <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                        </div>
                                                    </td>
                                                    <td align="center" class="colContent" style="padding-left: 5px;" width="150px">
                                                        <apex:inputField value="{!rec.item.FC_Quantity__c}" id="FC_Quantiy" />
                                                        <script>
                                                            disableInputField('{!rec.position}', '{!rec.pro.FC__c}', 'FC_Quantiy', 'myRepeat3');
                                                        </script>
                                                        <div style="{!If(rec.pro.FC__c == true, '', 'display:none;')}">
                                                            <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','FC_Quantiy','3');return false;" onmouseover="setPosition('{!rec.position}');setColumn('FC_Quantity__c')" style="margin-top:2px;text-align:center;">
                                                                <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                            <apex:commandLink onclick="forceCopyField('{!rec.position}','FC_Quantiy','3');return false;" onmouseover="setPosition('{!rec.position}');setColumn('FC_Quantity__c')" style="margin-top:2px;text-align:center;">
                                                                <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                        </div>
                                                    </td>
                                                    <td align="center" class="colContent" style="padding-left: 5px;" width="150px">
                                                        <apex:inputField value="{!rec.item.FC_Ad_served_every__c}" id="Fc_Ad_served" />
                                                        <script>
                                                            disableInputField('{!rec.position}', '{!rec.pro.FC__c}', 'Fc_Ad_served', 'myRepeat3');
                                                        </script>
                                                        <div style="{!If(rec.pro.FC__c == true, '', 'display:none;')}">
                                                            <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','Fc_Ad_served','3');return false;" onmouseover="setPosition('{!rec.position}');setColumn('FC_Ad_Served_every__c')" style="margin-top:2px;text-align:center;">
                                                                <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                            <apex:commandLink onclick="forceCopyField('{!rec.position}','Fc_Ad_served','3');return false;" onmouseover="setPosition('{!rec.position}');setColumn('FC_Ad_Served_every__c')" style="margin-top:2px;text-align:center;">
                                                                <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                        </div>
                                                    </td>
                                                    <td align="center" class="colContent" style="padding-left: 5px;" width="80px">
                                                        <apex:inputField value="{!rec.item.FC_Period__c}" id="FC_Period" />
                                                        <script>
                                                            disableInputField('{!rec.position}', '{!rec.pro.FC__c}', 'FC_Period', 'myRepeat3');
                                                        </script>
                                                        <div style="{!If(rec.pro.FC__c == true, '', 'display:none;')}">
                                                            <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','FC_Period','3');return false;" onmouseover="setPosition('{!rec.position}');setColumn('FC_Period__c')" style="margin-top:2px">
                                                                <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                            <apex:commandLink onclick="forceCopyField('{!rec.position}','FC_Period','3');return false;" onmouseover="setPosition('{!rec.position}');setColumn('FC_Period__c')" style="margin-top:2px">
                                                                <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                        </div>
                                                    </td>
                                                    <td class="colContent">&nbsp;</td>
                                                </tr>
                                            </apex:repeat>
                                        </table>
                                    </div>
                                    <script>
                                        $$('table.multiSelectPicklistTable tr.multiSelectPicklistRow select').each(function (i) {
                                                i.style.height = "55px";
                                                i.style.width = "130px";
                                            });
                                         // setWidthDiv('mydev3');
                                    </script>
                                </apex:tab>
                                <!-- Time-Targeting Tab -->
                                <apex:tab label="{!$Label.Tab4}" name="name4" id="tabFour" style="padding:0px;margin:0px;border:0px;background-color:#F3F3DC">
                                    <div style="padding:0px;margin:0px;border:0px solid;overflow-x: auto;overflow-y:hidden;" id="mydev4">
                                        <table cellpadding="0" cellspacing="0" width="100%">
                                            <tr id="tab4" style="height:64px;border-bottom:1px solid #E3DEB8;background-color:#F3F3EC">
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="{!$ObjectType.OpportunityLineItem.Fields.AdDayOfWeek__c.label}" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="{!$ObjectType.OpportunityLineItem.Fields.AdHourOfDay__c.label}" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="{!$ObjectType.OpportunityLineItem.Fields.AdKeywords__c.label}" />
                                                </td>
                                                <td class="colHeader">&nbsp;</td>
                                            </tr>
                                            <!-- <apex:repeat value="{!lstRecords}" var="rec" id="myRepeat4"> -->
                                            <apex:repeat value="{!lDisplayRec}" var="rec" id="myRepeat4">
                                                <tr style="height:84px;background-color:#F3F3DC" class="multiSelectPicklistRow">
                                                    <td align="center" class="colContent" style="padding-left: 5px;width: 290px;">
                                                        <div style="position:relative;">
                                                            <div style="position:absolute;top:6px;left:132px;width:25px;background-color:#dcdcdc;opacity:0.6;height:50px;{!If(rec.pro.Time__c == true, 'display:none;', '')}"></div>
                                                            <apex:inputField value="{!rec.item.AdDayOfWeek__c}" id="AdDayOfWeek" style="margin:0px;padding:0px;float:right" />
                                                        </div>
                                                        <div style="{!If(rec.pro.Time__c == true, '', 'display:none;')}">
                                                            <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','AdDayOfWeek','4');return false;" onmouseover="setPosition('{!rec.position}');setColumn('AdDayOfWeek__c')" style="margin-top:2px">
                                                                <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                            <apex:commandLink onclick="forceCopyField('{!rec.position}','AdDayOfWeek','4');return false;" onmouseover="setPosition('{!rec.position}');setColumn('AdDayofWeek__c')" style="margin-top:2px">
                                                                <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                        </div>
                                                    </td>
                                                    <td align="center" class="colContent" style="padding-left: 5px;width: 290px;">
                                                        <div style="position:relative;">
                                                            <div style="position:absolute;top:6px;left:132px;width:25px;background-color:#dcdcdc;opacity:0.6;height:50px;{!If(rec.pro.Time__c == true, 'display:none;', '')}"></div>
                                                            <apex:inputField value="{!rec.item.AdHourOfDay__c}" id="AdHourOfDay" style="margin:0px;padding:0px;float:right" />
                                                        </div>
                                                        <div style="{!If(rec.pro.Time__c == true, '', 'display:none;')}">
                                                            <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','AdHourOfDay','4');return false;" onmouseover="setPosition('{!rec.position}');setColumn('AdHourofDay__c')" style="margin-top:2px">
                                                                <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                            <apex:commandLink onclick="forceCopyField('{!rec.position}','AdHourOfDay','4');return false;" onmouseover="setPosition('{!rec.position}');setColumn('AdHourofDay__c')" style="margin-top:2px">
                                                                <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                        </div>
                                                    </td>
                                                    <td align="center" class="colContent" style="padding-left: 5px;" width="127px">
                                                        <apex:inputTextArea disabled="{!IF(rec.pro.Keywords__c == false, true, false)}" id="keyword" value="{!rec.keyWords}" cols="48" rows="3" style="vertical-align:middle;" onChange="mergeKVKW('{!rec.position}')" />
                                                        <div style="{!IF(rec.pro.Keywords__c == false, 'display:none;', '')}">
                                                            <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','keyword','4');return false;" onmouseover="setPosition('{!rec.position}');setColumn('AdBrowsersMajorVersion__c')" style="margin-top:2px">
                                                                <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                            <apex:commandLink onclick="forceCopyField('{!rec.position}','keyword','4');return false;" onmouseover="setPosition('{!rec.position}');setColumn('AdBrowsersMajorVersion__c')" style="margin-top:2px">
                                                                <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                        </div>
                                                    </td>
                                                    <td class="colContent">&nbsp;</td>
                                                </tr>
                                            </apex:repeat>
                                        </table>
                                    </div>
                                    <script>
                                        $$('table.multiSelectPicklistTable tr.multiSelectPicklistRow select').each(function (i) {
                                                i.style.height = "55px";
                                                i.style.width = "130px";
                                            });
                                         // setWidthDiv('mydev4');
                                    </script>
                                </apex:tab>
                                <!-- Technical Targeting Tab -->
                                <apex:tab label="{!$Label.Tab5}" name="name5" id="tabFive" style="padding:0px;margin:0px;border:0px;background-color:#F3F3DC">
                                    <div style="padding:0px;margin:0px;border:0px solid;overflow-x: auto;overflow-y:hidden;" id="mydev5">
                                        <table cellpadding="0" cellspacing="0" width="100%">
                                            <tr id="tab5" style="height:64px;border-bottom:1px solid #E3DEB8;background-color:#F3F3EC">
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="{!$ObjectType.OpportunityLineItem.Fields.AdOperatingSystems__c.label}" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="{!$ObjectType.OpportunityLineItem.Fields.AdWebBrowsers__c.label}" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="{!$ObjectType.OpportunityLineItem.Fields.AdBrowsersMinorVersion__c.label}" />
                                                </td>
                                                <td align="center" class="colHeader">
                                                    <apex:outputText value="{!$ObjectType.OpportunityLineItem.Fields.AdBrowsersMajorVersion__c.label}" />
                                                </td>
                                                <td class="colHeader">&nbsp;</td>
                                            </tr>
                                            <!-- <apex:repeat value="{!lstRecords}" var="rec" id="myRepeat5"> -->
                                            <apex:repeat value="{!lDisplayRec}" var="rec" id="myRepeat5">
                                                <tr style="height:84px;background-color:#F3F3DC" class="multiSelectPicklistRow">
                                                    <td align="center" class="colContent" style="padding-left: 5px;width: 290px;">
                                                        <div style="position:relative;">
                                                            <div style="position:absolute;top:6px;left:132px;width:25px;background-color:#dcdcdc;opacity:0.6;height:50px;{!If(rec.pro.Tech_targeting__c == true, 'display:none;', '')}"></div>
                                                            <apex:inputField value="{!rec.item.AdOperatingSystems__c}" id="AdOperating" style="margin:0px;padding:0px;float:right" />
                                                        </div>
                                                        <div style="{!If(rec.pro.Tech_targeting__c == true, '', 'display:none;')}">
                                                            <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','AdOperating','5');return false;" onmouseover="setPosition('{!rec.position}');setColumn('AdOperatingSystems__c')" style="margin-top:2px">
                                                                <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                            <apex:commandLink onclick="forceCopyField('{!rec.position}','AdOperating','5');return false;" onmouseover="setPosition('{!rec.position}');setColumn('AdOperatingSystems__c')" style="margin-top:2px">
                                                                <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                        </div>
                                                    </td>
                                                    <td align="center" class="colContent" style="padding-left: 5px;width: 290px;">
                                                        <div style="position:relative;">
                                                            <div style="position:absolute;top:6px;left:132px;width:25px;background-color:#dcdcdc;opacity:0.6;height:50px;{!If(rec.pro.Tech_targeting__c == true, 'display:none;', '')}"></div>
                                                            <apex:inputField value="{!rec.item.AdWebBrowsers__c}" id="AdWebBrowsers" style="margin:0px;padding:0px;float:right" />
                                                        </div>
                                                        <div style="{!If(rec.pro.Tech_targeting__c == true, '', 'display:none;')}">
                                                            <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','AdWebBrowsers','5');return false;" onmouseover="setPosition('{!rec.position}');setColumn('AdWebBrowsers__c')" style="margin-top:2px">
                                                                <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                            <apex:commandLink onclick="forceCopyField('{!rec.position}','AdWebBrowsers','5');return false;" onmouseover="setPosition('{!rec.position}');setColumn('AdWebBrowsers__c')" style="margin-top:2px">
                                                                <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                        </div>
                                                    </td>
                                                    <td align="center" class="colContent" style="padding-left: 5px;">
                                                        <apex:inputField value="{!rec.item.AdBrowsersMinorVersion__c}" id="AdBrowsersMinor" style="width:120px;" />
                                                        <script>
                                                            disableInputField('{!rec.position}', '{!rec.pro.Tech_targeting__c}', 'AdBrowsersMinor', 'myRepeat5');
                                                        </script>
                                                        <div style="{!If(rec.pro.Tech_targeting__c == true, '', 'display:none;')}">
                                                            <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','AdBrowsersMinor','5');return false;" onmouseover="setPosition('{!rec.position}');setColumn('AdBrowsersMinorVersion__c')" style="margin-top:2px">
                                                                <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                            <apex:commandLink onclick="forceCopyField('{!rec.position}','AdBrowsersMinor','5');return false;" onmouseover="setPosition('{!rec.position}');setColumn('AdBrowsersMinorVersion__c')" style="margin-top:2px">
                                                                <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                        </div>
                                                    </td>
                                                    <td align="center" class="colContent" style="padding-left: 5px;">
                                                        <apex:inputField value="{!rec.item.AdBrowsersMajorVersion__c}" id="AdBrowserMajor" style="width:120px;" />
                                                        <script>
                                                            disableInputField('{!rec.position}', '{!rec.pro.Tech_targeting__c}', 'AdBrowserMajor', 'myRepeat5');
                                                        </script>
                                                        <div style="{!If(rec.pro.Tech_targeting__c == true, '', 'display:none;')}">
                                                            <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','AdBrowserMajor','5');return false;" onmouseover="setPosition('{!rec.position}');setColumn('AdBrowsersMajorVersion__c')" style="margin-top:2px">
                                                                <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span>

                                                            <apex:commandLink onclick="forceCopyField('{!rec.position}','AdBrowserMajor','5');return false;" onmouseover="setPosition('{!rec.position}');setColumn('AdBrowsersMajorVersion__c')" style="margin-top:2px">
                                                                <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                        </div>
                                                    </td>
                                                    <td class="colContent">&nbsp;</td>
                                                </tr>
                                            </apex:repeat>
                                        </table>
                                    </div>
                                    <script>
                                        $$('table.multiSelectPicklistTable tr.multiSelectPicklistRow select').each(function (i) {
                                                i.style.height = "55px";
                                                i.style.width = "130px";
                                            });
                                         //setWidthDiv('mydev5');
                                    </script>
                                </apex:tab>
                                <!-- Regional Targeting -->
                                <apex:tab label="{!$Label.Tab7}" name="tabname7" id="tabname7" style="padding:0px;margin:0px;border:0px;background-color:#F3F3DC">
                                    <div style="padding:0px;margin:0px;border:0px solid;overflow-x: auto;overflow-y:hidden;" id="mydev7">
                                        <table cellpadding="0" cellspacing="0" width="100%">
                                            <tr id="tab7" style="height:64px;border-bottom:1px solid #E3DEB8;background-color:#F3F3EC">
                                                <td align="center" class="colHeader" width="60px">&nbsp;</td>
                                                <td align="center" class="colHeader" width="427px">Countries</td>
                                                <td align="center" class="colHeader" width="427px">Cities</td>
                                                <td align="center" class="colHeader" width="127px">&nbsp;</td>
                                                <!-- <td class="colHeader">&nbsp;</td> -->
                                            </tr>
                                            <!-- <apex:repeat value="{!lstRecords}" var="rec" id="myRepeat7">-->
                                            <apex:repeat value="{!lDisplayRec}" var="rec" id="myRepeat7">
                                                <tr style="height:84px">
                                                    <td align="center" class="colContent" style="padding-left: 5px;" width="60px"></td>
                                                    <td align="center" class="colContent" style="padding-left: 5px;" width="427px">
                                                        <table cellspacing="0" cellpadding="0">
                                                            <tr>
                                                                <td>
                                                                    <apex:commandButton rendered="{!IF(rec.pro.Geo_IP__c==true, true, false)}" id="btnCountry" value="Select" onclick="getTargetingTreePopup(this.id,{!rec.position},'CountriesButton'); return false;" />
                                                                </td>
                                                                <td>
                                                                    <table cellspacing="0" cellpadding="0">
                                                                        <tr>
                                                                            <td>
                                                                                <apex:inputTextArea id="txaCountry" value="{!rec.item.Countries_Description__c}" cols="48" rows="4" style="vertical-align:middle;" />
                                                                                <script>
                                                                                    disableInputField('{!rec.position}', '{!rec.pro.Geo_IP__c}', 'txaCountry', 'myRepeat7');
                                                                                </script>
                                                                            </td>
                                                                            <td>
                                                                                <div style="{!If(rec.pro.Geo_IP__c == true, '', 'display:none;')}">
                                                                                    <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','txaCountry','7');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Countries_Description__c')" style="margin-top:2px;padding-left:5px">
                                                                                        <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" /></apex:commandLink> <span></span> 
                                                                                    <apex:commandLink onclick="forceCopyField('{!rec.position}','txaCountry','7');return false;" onmouseover="setPosition('{!rec.position}');setColumn('Countries_Description__c')" style="margin-top:2px;padding-left:5px">
                                                                                        <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" /></apex:commandLink>
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td align="center" class="colContent" style="padding-left: 5px;" width="427px">
                                                        <table cellspacing="0" cellpadding="0">
                                                            <tr>
                                                                <td>
                                                                    <apex:commandButton rendered="{!IF(rec.pro.Geo_IP__c==true, true, false)}" id="btnCities" value="Select" onclick="getTargetingTreePopup(this.id,{!rec.position},'CitiesButton'); return false;" />
                                                                </td>
                                                                <td>
                                                                    <table cellspacing="0" cellpadding="0">
                                                                        <tr>
                                                                            <td>
                                                                                <apex:inputTextArea id="txaCities" value="{!rec.item.City_description__c}" cols="48" rows="4" style="vertical-align:middle;" />
                                                                                <script>
                                                                                    disableInputField('{!rec.position}', '{!rec.pro.Geo_IP__c}', 'txaCities', 'myRepeat7');
                                                                                </script>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <div style="{!If(rec.pro.Geo_IP__c == true, '', 'display:none;')}">
                                                                        <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','txaCities','7');return false;" onmouseover="setPosition('{!rec.position}');setColumn('City_description__c')" style="margin-top:2px;padding-left:5px">
                                                                            <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" />
                                                                        </apex:commandLink> <span></span>

                                                                        <apex:commandLink onclick="forceCopyField('{!rec.position}','txaCities','7');return false;" onmouseover="setPosition('{!rec.position}');setColumn('City_description__c')" style="margin-top:2px;padding-left:5px">
                                                                            <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" />
                                                                        </apex:commandLink>
                                                                    </div>
                                                                </td>
                                                                
                                                            </tr>
                                                         </table>
                                                    </td>
                                                    <td class="colContent">&nbsp;</td>
                                                </tr>
                                            </apex:repeat>
                                        </table>
                                    </div>
                                <script>
                                    $$('table.multiSelectPicklistTable tr.multiSelectPicklistRow select').each(function (i) {
                                            i.style.height = "55px";
                                            i.style.width = "130px";
                                        });
                                     //setWidthDiv('mydev2');
                                </script>
                        </apex:tab>
                        <!-- Final Key Value String Tab -->
                        <apex:tab label="KeyValue String" name="tabname9" id="tabname9" style="padding:0px;margin:0px;border:0px;background-color:#F3F3DC">
                            <div style="padding:0px;margin:0px;border:0px solid;overflow-x: auto;overflow-y:hidden;" id="mydev9">
                                <table cellpadding="0" cellspacing="0" width="100%">
                                    <tr id="tab9" style="height:64px;border-bottom:1px solid #E3DEB8;background-color:#F3F3EC">
                                        <td align="center" class="colHeader">Final Key Value String</td>
                                        <td align="center" class="colHeader">&nbsp;</td>
                                    </tr>
                                    <apex:repeat value="{!lDisplayRec}" var="rec" id="myRepeat9">
                                        <tr style="height:84px">
                                            <td align="center" class="colContent" style="padding-left: 5px;" width="200px">
                                                <div>
                                                    <apex:inputTextArea id="finalKey" value="{!rec.item.AdKeywords__c}" cols="48" rows="3" style="vertical-align:middle;" />
                                                </div>
                                                <!-- <apex:commandLink onclick="checkValidationCopyField('{!rec.position}','finalKey','9');return false;" onmouseover="setPosition('{!rec.position}');setColumn('AdBrowsersMajorVersion__c')" style="margin-top:2px">
                                                            <apex:image value="{!$Resource.Copy}" title="{!$Label.ColumnCopy}" />
                                                        </apex:commandLink>
                                                        <span></span>
                                                        <apex:commandLink onclick="forceCopyField('{!rec.position}','finalKey','9');return false;" onmouseover="setPosition('{!rec.position}');setColumn('AdBrowsersMajorVersion__c')" style="margin-top:2px">
                                                            <apex:image value="{!$Resource.forcecopy}" title="{!$Label.Force_Copy}" />
                                                        </apex:commandLink>
                                                     -->
                                            </td>
                                            <td align="center" class="colContent" style="padding-left: 5px;">&nbsp;</td>
                                        </tr>
                                    </apex:repeat>
                                </table>
                            </div>
                            <script>
                                $$('table.multiSelectPicklistTable tr.multiSelectPicklistRow select').each(function (i) {
                                        i.style.height = "55px";
                                        i.style.width = "130px";
                                    });
                            </script>
                        </apex:tab>
                        </apex:tabPanel>
                        </td>
                    </tr>
                </table>
            </div>
            <script>
                if (navigator.userAgent.indexOf("Firefox") != -1) {
                    var elem = document.getElementById('myPage:myForm').elements;
                    for (var i = 0; i < elem.length; i++) {
                        if (elem[i].type == "textarea") {
                            var str = elem[i].id;
                            if (str.match(/LineDescription/gi) || str.match(/keyword/gi) || str.match(/finalKey/gi)) {
                                document.getElementById(str).rows = 2;
                            }

                        }
                    }

                }

                function closeMessage(pId) {
                    document.getElementById(pId).style.display = 'none';
                }

                var IE = document.all ? true : false;
                if (!IE) document.captureEvents(Event.MOUSEMOVE)
                 document.onmousemove = getMouseXY;
                var tempX = 0;
                var tempY = 0;

                function getMouseXY(e) {
                    if (IE) { // grab the x-y pos.s if browser is IE
                        tempX = event.clientX + document.body.scrollLeft;
                        tempY = event.clientY + document.body.scrollTop;
                    } else { // grab the x-y pos.s if browser is NS
                        tempX = e.pageX;
                        tempY = e.pageY;
                    }
                    if (tempX < 0) {
                        tempX = 0;
                    }
                    if (tempY < 0) {
                        tempY = 0;
                    }
                    return true;
                }

                function changeTextValue(helpText, lId, pId, left, top) {
                    var panelId = document.getElementById(pId);

                    tempX = tempX - 10;
                    tempY = tempY - 100;
                    panelId.style.display = 'block';
                    panelId.style.left = tempX + 'px';
                    panelId.style.top = tempY + 'px';
                    panelId.style.border = '1px solid orange';
                    panelId.style.padding = '2px 5px';
                    panelId.style.backgroundColor = '#fefdB9';
                    panelId.style.position = 'absolute';
                    panelId.style.fontWeight = 'normal';
                    panelId.style.textAlign = 'left';
                    panelId.style.whiteSpace = 'normal';
                    panelId.style.zIndex = 2000;

                    panelId.innerHTML = helpText.replace(/\n/gi, '<br/>');
                }
            </script>
            <!-- Block Button Page -->
            <br/>
            <div style="position:relative;displayinline;">
                <div style="text-align:left;position:absolute;">
                    <apex:outputLabel style="font-weight:bold;" value="{!disNumOfRecPerPage}" id="displayNumRec" />
                </div>
                <div style="text-align:right;padding-right:20px;">
                    <apex:commandButton value="{!$Label.Previous}" title="{!If(disablePre == true , '','{!$Label.Previous}')}" reRender="MyPageBlock" action="{!goPrevious}" status="status" disabled="{!disablePre}" styleclass="{!IF(disablePre == true ,'disableStyle', 'enableStyle2')}"
                    style="padding: 0 7px 3px;" /><span></span>

                    <apex:repeat value="{!numBtn}" var="num">
                        <apex:commandButton value="{!num}" action="{!gotoPage}" title="{!num}" reRender="MyPageBlock" status="status" disabled="{!IF(pageNum == num ,true, false)}" styleclass="{!IF(pageNum != num , 'btnNotDisplaying','enableStyle')}" style="{!IF(pageNum != num ,'padding: 0 7px 2px;','padding: 0 7px 3px;color:#FFFFFF;')}">
                            <apex:param name="pageNum" value="{!num}" assignTo="{!pageNum}" /></apex:commandButton> <span></span>

                    </apex:repeat>
                    <apex:commandButton value="{!$Label.Next}" title="{!IF(disableNext == true ,'','{!$Label.Next}')}" reRender="MyPageBlock" action="{!goNext}" status="status" disabled="{!disableNext}" styleclass="{!IF(disableNext == true ,'disableStyle','enableStyle2' )}"
                    style="padding: 0 7px 3px;" />
                </div>
            </div>
            <!-- End -->
            <script>
                onload();
            </script>
        </apex:pageBlock>
        <apex:actionStatus id="status">
            <apex:facet name="start">
                <c:Load BackColor="#efefef" borderColor="#efefef" borderSize="3" height="50px" width="180px" Message="Please, wait..." messageStyle="color:darkred;font-size:10pt;font-family:arial;font-weight:bold;" imageUrl="/img/loading.gif" />
            </apex:facet>
        </apex:actionStatus>
        <div id="InlineEditDialog" class="overlayDialog inlineEditDialog" style="width:400px; top:40%; display: none; visibility: visible;margin-left: 340px">
            <div class="topRight">
                <div class="topLeft">
                    <img id="InlineEditDialogX" class="dialogClose" src="/s.gif" onclick="cancel();" title="{!$Label.Close}" onmouseout="this.className = 'dialogClose'" onmouseover="this.className = 'dialogCloseOn'" />
                     <h2 id="InlineEditDialogTitle">Editable Text</h2>

                </div>
            </div>
            <div class="middle">
                <div id="InlineEditDialogContent" class="innerContent">
                    <div class="activeField">
                        <div class="inlineEditCompoundDiv" align="center">
                            <div style="border:0px solid #888888;" id="content"></div>
                        </div>
                    </div>
                    <div></div>
                    <div style="display: none;"></div>
                    <div class="buttons">
                        <apex:CommandButton value="{!$Label.Button_Ok}" title="{!$Label.Button_Ok}" onclick="checkValidationSplit();cancel();return false;" />
                        <apex:CommandButton value="{!$Label.Button_Cancel}" title="{!$Label.Button_Cancel}" onclick="cancel();return false;" />
                    </div>
                </div>
                <div class="bottomRight">
                    <div class="bottomLeft"></div>
                </div>
            </div>
        </div>
        <div id="InlineCopyDialog" class="overlayDialog inlineEditDialog" style="width:400px; top:40%; display: none; visibility: visible;margin-left: 340px">
            <div class="topRight">
                <div class="topLeft">
                    <img id="InlineCopyDialogX" class="dialogClose" src="/s.gif" onclick="cancel();" title="{!$Label.Close}" onmouseout="this.className = 'dialogClose'" onmouseover="this.className = 'dialogCloseOn'" />
                     <h2 id="InlineCopyDialogTitle">Editable Text</h2>

                </div>
            </div>
            <div class="middle">
                <div id="InlineCopyDialogContent" class="innerContent">
                    <div class="activeField">
                        <div class="inlineCopyCompoundDiv" align="center">
                            <div style="border:0px solid #888888;" id="contentCopy"></div>
                        </div>
                    </div>
                    <div></div>
                    <div style="display: none;"></div>
                    <div class="buttons">
                        <apex:CommandButton value="{!$Label.Button_Ok}" title="{!$Label.Button_Ok}" onclick="checkValidationCopy();cancelCx();return false;" />
                        <apex:CommandButton value="{!$Label.Button_Cancel}" title="{!$Label.Button_Cancel}" onclick="cancelCx();return false;" />
                    </div>
                </div>
                <div class="bottomRight">
                    <div class="bottomLeft"></div>
                </div>
            </div>
        </div>
        <div id="overlayBackground" class="overlayBackground" style="width: 100%; height: 100%; display: none; left: 0; top: 0px"></div>
    </apex:form>
    <script>
        if (!isIE()) {
            var ag = document.getElementById('header');
            ag.style.height = '63px';
            var hr = document.getElementById('myPage:myForm:uAgent');
            hr.value = '63px';
        }

        function openTargetingTreePopup(fromId, hiddenId, source) {

            var width = 850;
            var height = 640;
            var left = (screen.width - width) / 2;
            var top = (screen.height - height) / 2;
            var params = 'width=' + width + ', height=' + height;
            params += ', top=' + top + ', left=' + left;
            params += ', directories=no';
            params += ', location=no';
            params += ', menubar=no';
            params += ', resizable=no';
            params += ', scrollbars=no';
            params += ', status=no';
            params += ', toolbar=no';
            var url = '';
            var vTargetId = document.getElementById(hiddenId);
            if (source == 'TargetingButton') {
                var linkProId = hiddenId.replace('hidTargetId', 'hidProId');
                var proId = document.getElementById(linkProId);
                url = '/apex/apex/ContentHierarchyPage?fromId=' + fromId + '&targetId=' + vTargetId.value + '&proId=' + proId.value;
            }
            if (source == 'KeyValueButton') {
                var linkAvail = hiddenId;
                linkAvail = linkAvail.replace('hidTargetId', 'hidAvaiKV');
                var avaiKV = document.getElementById(linkAvail);

                var kvStringId = hiddenId;
                kvStringId = kvStringId.replace('hidTargetId', 'keyvalueString');
                var kvString = document.getElementById(kvStringId);

                if (avaiKV.value != 'None' && avaiKV.value != 'none') {

                    url = '/apex/KeyValueHierachyPage?fromId=' + fromId + '&targetId=' + vTargetId.value + '&avaiKV=' + avaiKV.value + '&kvString=' + kvString.value;
                } else {
                    alert('No Key Values available for this product.');
                }
            }
            if (source == 'AreacodesButton') {
                url = '/apex/TreeAreaCodes?fromId=' + fromId + '&targetId=' + vTargetId.value + '&hidId=' + hiddenId;
            }
            if (source == 'CitiesButton') {
                url = '/apex/CitiesHierachyPage?fromId=' + fromId + '&targetId=' + vTargetId.value + '&hidId=' + hiddenId;
            }

            if (source == 'CountriesButton') {
                url = '/apex/TreeCountriesPage2?fromId=' + fromId + '&targetId=' + vTargetId.value + '&hidId=' + hiddenId;
            }
            var newwin = window.open(url, 'TreeProduct', params);
            if (window.focus) {
                newwin.focus();
            }
        }
    </script>
</apex:page>