<apex:page showHeader="false" sidebar="false" standardStylesheets="false" id="thePage" docType="html-5.0" controller="InvoicesPaymentMethodsPopup" title="Pay Invoices | Gumtree.com">
     <head>   
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
        <link rel="icon" type="image/png" href="{!$Resource.FavouriteSiteIcon}" />
        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
         
        
        <apex:stylesheet value="{!URLFOR($Resource.P2P_Resources, 'css/bootstrap.min.css')}" />
        <apex:stylesheet value="{!URLFOR($Resource.P2P_Resources, 'css/custom_bootrap.css')}" />
        <apex:stylesheet value="{!URLFOR($Resource.P2P_Resources, 'css/font-awesome.min.css')}" />
        <script src="{!URLFOR($Resource.P2P_Resources, 'js/bootstrap.min.js')}"></script>
        <script src="{!URLFOR($Resource.P2P_ResMyCheckout, 'jquery.popupoverlay.js')}"></script>
        
        <apex:stylesheet value="{!URLFOR($Resource.P2P_Resources, 'helperDialog/helperDialog.css')}" />
        <script src="{!URLFOR($Resource.P2P_Resources, 'helperDialog/helperDialog.js')}"></script>
        
        <script>
            function assignVal2Cal(parentIndex, subIndex){
                setIndexProductGroupANDProduct(parentIndex, subIndex);
                calculatePrice();
            }
            
            function assignVal2remove(parentIndex, subIndex){
                setIndexProductGroupANDProduct(parentIndex, subIndex);
                removeMediabasket();
            } 
            
            function setIndexProductGroupANDProduct(parentIndex, subIndex){
                document.getElementById("thePage:theForm:indexProGroupSelected").value = parentIndex;
                document.getElementById("thePage:theForm:indexSubPro").value = subIndex;
            }

        </script>
        <style>
                        .wrapMeByBlock{
                            background-color: #fff;
                            float: left;
                            padding: 15px;
                            width: 100%;
                        }
                        .iHiden{
                            display: none;
                        }
                        .effectSelect select{
                            padding-top: 6px;
                            padding-bottom: 6px;
                        }
                        .iNoWrap{
                            white-space: nowrap;
                        }
                        .addPayMentMethod{
                            cursor: pointer;
                            font-size: 18px;
                        }
                        #my_popup{
                            background-color: #fff;
                            max-width: 1150px;
                            padding: 15px 15px 40px;
                            width: 95%;
                            display: none;
                            position: relative;
                            border: 2px solid #cdcdcd;
                            border-radius: 5px;
                        }
                        #pay_by_invoice_popup{
                            max-width: 350px;
                            width: 100%;
                        }
                        .popup{
                            background-color: #fff;
                            max-width: 1150px;
                            padding: 15px 15px 40px;
                            width: 95%;
                            display: none;
                            position: relative;
                            border: 2px solid #cdcdcd;
                            border-radius: 5px;
                        }
                        .transparent_content{
                            -khtml-opacity:0.4; 
                             -moz-opacity:0.4; 
                             -ms-filter:"alpha(opacity=40)";
                              filter:alpha(opacity=40);
                              filter: progid:DXImageTransform.Microsoft.Alpha(opacity=0.4);
                              opacity:0.4; 
                              pointer-events: none;
                        }
                        .wrapConfirm{
                            float: left;
                            margin-top: 15px;
                            padding-left: 10px;
                            width: 100%;    
                        }
                        .wrapConfirm .checkbox-checked{
                            float: left;
                        }
                        .termCondition{
                            float: left;
                            margin-top: 5px;
                            padding-left: 10px;
                        }
                        .itemInCart{
                            float: left;
                            font-size: 25px;
                            margin-top: 2px;
                            padding-left: 60px;
                        }
                        input[type="date"]{
                            border: 2px solid #cfcece;
                            border-radius: 5px;
                            padding: 5px 10px;
                            line-height: 21px;
                        }
                        .clearPadding{
                            padding-left: 0;
                            padding-right: 0;
                        }
                        .clearPaddingRight{
                            padding-right: 0;
                        }
                        .clearPaddingLeft{
                            padding-left: 0;
                        }
                        
                        .inputFullWidth{
                            width: 100%;
                        }
                       
                        .hideAllSize{
                            display: none;
                        }
                        
                        .clearMe{
                            float: left;
                            width: 100%;
                            clear: both;
                        }
                        .btnAcceptTermCondiction{
                            padding-bottom: 7px;
                            padding-top: 7px;
                        }
                        .btnCancelTermCondiction{
                            background-color: #ddd;
                            border: medium none;
                            box-shadow: 0 2px 2px -1px #666666;
                            color: #333 !important;
                            float: none;
                            padding: 7px 16px;
                            width: auto;
                        }
                        .paddingTop{
                            padding-top: 15px;
                        }
                        
                        .paddingLeft{
                            padding-left: 15px;
                        }
                        .paddingRight{
                            padding-right: 15px;
                        }
                        
                        .headerIcon{
                            background: url("{!URLFOR($Resource.P2P_Icons, 'gumtree-icons/info-icon.png')}") no-repeat scroll center center transparent;
                            width: 19px;
                            height: 19px;
                            float: left;
                            padding-right: 5px;
                            margin-right: 5px;
                        }
                        .iColorBlue{
                            color: #2A5DB0;
                        }
                        .iColorGrey{
                            color: #939598;
                        }
                        .iBold{
                            font-family: "SourceSansPro Bold";
                            padding-left: 4px;
                            float:right;
                        }
                        .iRadius{
                            -webkit-border-radius: 5px;    
                            border-radius: 5px; 
                            -moz-border-radius:5px;
                            -khtml-border-radius:5px;
                        }
                        
                        .iRadiusMini{
                            -webkit-border-radius: 3px;    
                            border-radius: 3px; 
                            -moz-border-radius:3px;
                            -khtml-border-radius:3px;
                        }
                        .spacingTop{
                            margin-top: 15px;
                        }
                        .spacingBottom{
                            margin-bottom: 15px;
                        }
                        
                        .btnContinue{
                            padding-left: 0;
                            padding-right: 0;
                            margin-top: 0;
                        }
                        .alert {
                            background-color: #f0f0f0;
                            border: 1px solid transparent;
                            border-radius: 4px;
                            float: left;
                            margin-bottom: 0;
                            margin-top: 15px;
                            padding: 15px;
                            width: 100%;
                        }
                        .setRight{
                            float: right;
                        }
                        .removeBackground{
                            background-color: transparent;
                        }
                        .whiteBg{
                            background-color: #fff;
                        }
                        .removeAllPadding{
                            padding: 0;
                        }
                        .paddingTB{
                            padding-bottom: 10px;
                            padding-top: 10px;
                            position: relative;
                        }
                        .logoCart{
                            left: 15px;
                            position: absolute;
                        }
                        .wrapItemRightByBlock{
                            background-color: #fff;
                            float: left;
                            padding: 15px;
                            width: 100%;
                        }
                        .lb{
                            background-color: #f0f0f0;
                            border-bottom: 2px solid #cdcdcd;
                            padding-bottom: 10px;
                            padding-left: 10px;
                            padding-top: 10px;
                        }
                        .vl{
                            background-color: #f0f0f0;
                            border-bottom: 2px solid #cdcdcd;
                            padding-bottom: 10px;
                            padding-left: 10px;
                            padding-top: 10px;
                            border-left: 1px solid #cdcdcd;
                            padding-right: 10px;
                        }
                        .wrapPaymentInfo{
                            background-color: #f0f0f0;
                            border-bottom: 2px solid #cdcdcd;
                            -webkit-border-radius: 5px;    
                              border-radius: 5px; 
                              -moz-border-radius:5px;
                              -khtml-border-radius:5px;
                            float: left;
                            width: 100%;
                        }
                        .radiusTopLeft{
                            border-radius: 5px 0 0 0;
                        }
                        .radiusBottomLeft{
                            border-radius: 0 0 0 5px;
                        }
                        .radiusTopRight{
                            border-radius: 0 5px 0 0;
                        }
                        .radiusBottomRight{
                            border-radius: 0 0 5px 0;
                        }
                        .lblVat{
                            font-size: 15px; 
                            line-height: 23px;
                        }
                        .vatPrice{
                            font-size: 15px;
                            line-height: 23px;
                        }
                        .lblTotal{
                            font-family: "SourceSansPro Bold";
                            font-size: 23px;
                            line-height: 23px;
                        }
                        .totalPrice{
                            font-family: "SourceSansPro Bold";
                            font-size: 23px;
                            line-height: 23px;
                        }
                        .iSeperateBorder{
                            border-bottom: 1px solid #cdcdcd;
                            padding-bottom: 10px;
                            width: 100%;
                        }
                        .btnPayByCard{
                            
                        }
                         .btnLoginPayPal{
                            background: none repeat scroll 0 0 #0079c1;
                            border-color: #0079c1;
                            border-radius: 5px;
                            box-sizing: border-box;
                            color: #fff;
                            cursor: pointer;
                            display: inline-block;
                            font-size: 15px;
                            font-weight: bold;
                            height: 40px;
                            line-height: 1.4545em;
                            margin-bottom: 0;
                            padding: 9px 15px 10px;
                            text-align: center;
                            vertical-align: middle;
                            position: relative;
                            transition: border-color 0.3s ease 0s;
                            border: none;
                        }
                        .btnLoginPayPal:HOVER{
                            background: none repeat scroll 0 0 #0285d2;
                            color: #fff;
                            text-decoration: none;
                        }
                        .iconpayByCard{
                            background-image: url("{!URLFOR($Resource.P2P_ResMyCheckoutPayment, 'white_lock.png')}");
                            background-position: left -2px;
                            background-repeat: no-repeat;
                            padding-bottom: 4px;
                            padding-left: 30px;
                            padding-top: 4px;
                        }
                        
                        .btnPayByInvoice{
                            background-image: url("{!URLFOR($Resource.P2P_ResMyCheckoutPayment, 'invoice_white.png')}");
                            background-position: left -2px;
                            background-repeat: no-repeat;
                            padding-bottom: 4px;
                            padding-left: 30px;
                            padding-top: 4px;
                        }
                        
                        .iconPayPal{
                        background-image: url("{!URLFOR($Resource.P2P_ResMyCheckoutPayment, 'paypal.png')}");
                        background-position: left 1px;
                        background-repeat: no-repeat;
                        padding-bottom: 4px;
                        padding-left: 30px;
                        padding-top: 4px;
                         }
                          
                        .wrapAvailablePaymentMethod{
                            padding-right: 50px;
                            position: relative;
                        }
                        .payment_method{
                            margin-top: 5px;
                            max-width: 100%;
                        }
                        .grey_lock{
                            bottom: 15px;
                            position: absolute;
                            right: 0;
                        }
                        .wrapContact{
                            padding-right: 115px;
                            position: relative;
                            min-height: 95px;
                        }
                        .profilePic{
                            position: absolute;
                            right: 0;
                            top: 0;
                            width: 100px;
                        }
                        .labelPackageDetail{
                            left: 0;
                            position: absolute;
                            top: 38px;
                        }
                        .rowFeedPackage{
                            min-height: 30px;
                            padding-right: 30px;
                            position: relative;
                            padding-top: 15px;
                        }
                        .removeFeedPackage{
                            position: absolute;
                            right: 0;
                            bottom: 14px;
                            cursor: pointer;
                        }
                        .rowFeedPackage .col-md-2{
                            min-height: 60px;
                        }
                        .iTopBoder{
                            border-top: 1px solid #cdcdcd;
                            margin-top: 15px;
                            padding-top: 15px;
                        }
                        .btnApplyDiscount{
                            background-color: #ddd;
                            border: medium none;
                            box-shadow: 0 2px 2px -1px #666666;
                            color: #333 !important;
                            float: none;
                            margin-top: -4px;
                            padding: 7px 16px;
                            width: auto;
                        }
                        .alignDiscountBlock{
                            text-align: right;
                        }
                        .userNoPayment{
                            
                        }
                        .userHavePayment{
                            display: none;   
                        }
                        .plusIconSize{
                            float: left;
                            font-size: 27px;
                            padding-right: 15px;
                        } 
                        .titleHasPayment{
                            float: left;
                        }
                        .editPayment{
                            float: right;
                            font-family: "SourceSansPro Regular";
                            cursor: pointer;
                            padding-right: 25px;
                            background: url("{!URLFOR($Resource.P2P_Resources, 'img/edit.png')}") no-repeat scroll right center transparent;
                        }
                        .iColorOrange{ 
                            color: #f47421;
                        }
                        
                        
                        .doneEditPayment{
                            float: right;
                            cursor: pointer;
                            background: url("{!URLFOR($Resource.P2P_ResMyCheckout, 'tick_icon.png')}") no-repeat scroll right center / auto 18px transparent;
                            padding-right: 25px;
                        }
                        .cancelEditPayment{
                            float: left;
                            cursor: pointer;
                        }
                        input[type="radio"]{
                            display: none;
                        }
                        
                        .wrapActionPayment{
                            border: 1px solid #cdcdcd;
                            border-radius: 5px;
                            float: left;
                            margin: 15px 0 0;
                            overflow: hidden;
                            padding: 0;
                            width: 100%;
                        }
                        .wrapActionPayment li{
                            position: relative;
                        }
                        .wrapActionPayment li{
                            list-style: none;
                            border-bottom: 1px solid #cdcdcd;
                            min-height: 50px;
                            padding-left: 10px;
                            padding-right: 10px;
                            padding-top: 9px;
                        }
                        .wrapActionPayment li:last-child{
                            border-bottom: 0;
                        }
                        .wrapActionPayment label{
                            float: left;
                        }
                        .iconPayment{
                            float: left;
                        }
                        .lbCheck{
                            float: left;
                            font-family: "SourceSansPro Bold";
                            font-size: 16px;
                            line-height: 18px;
                            width: 100%;
                        }
                        .valueCheck{
                            float: left;
                            line-height: 10px;
                            width: 100%;
                        }
                        .wrapLbBlCheck{
                            float: left;
                            padding-left: 10px;
                            width: 60%;
                        }
                        
                        .activeEditPayment .showEdit{
                            display: inherit;
                        }
                        .activeEditPayment .hideEdit{
                            display: none;
                        }
                        .activeEditPayment .wrapActionPayment li label{
                            background-image: none;
                        }
                        .activeEditPayment .wrapActionPayment li .deletePayment{
                            cursor: pointer;
                            left: 10px;
                            position: absolute;
                            top: 12px;
                            display: inherit;
                        }
                        .close_popup{
                            cursor: pointer;
                            position: absolute;
                            right: -10px;
                            top: -10px;
                        }
                        .wrapBtnCancel{
                            float: left;
                        }
                        .wrapBtnAccept{
                            float: left;
                            margin-left: 15px;
                        }
                        input[type="password"] {
                            border: 2px solid #cfcece;
                            border-radius: 5px;
                            padding: 5px 10px;
                        }
                        .setLeft{
                            float: left;
                        }
                        #creditCard_popup{
                            max-width: 430px;
                        }
                        #confirm_trans{
                            max-width: 500px;
                        }
                        #paypal_popup{
                            max-width: 380px;
                        }
                        #paypal_popup input,
                        #paypal_popup button{
                            width: 100%;
                            max-width: 350px;
                        }
                        @media (max-width: 1024px){
                            /*default border-bottom of button #df531b*/
                            .hideUnder1024{
                                display: none;
                            }
                            .showUnder1024{
                                display: inline-block;
                            }
                            .rowFeedPackage .col-md-2{
                                width: 33.3333%;
                                float: left;
                            }
                            .removeFeedPackage{
                                bottom: 4px;
                            }
                            .alignDiscountBlock{
                                text-align: left;
                            }
                            .overideColMd6 .col-md-6{
                                width: 100%;
                                float: left;
                                margin-top: 10px;
                            }
                        }
                        @media (max-width: 1023px){
                            
                        }
                       
                        @media (max-width: 768px){
                            .hideUnder768{
                                display: none;
                            }
                            .showUnder768{
                                display: block;
                            }
                            .rowFeedPackage .col-md-2{
                                width: 50%;
                            }
                            .rowFeedPackage .col-md-2:nth-child(1n){
                                padding-left: 0;
                            }
                            .rowFeedPackage .col-md-2:nth-child(2n){
                                padding-left: 15px;
                            }
                            .rowFeedPackage {
                                min-height: 30px;
                                padding-left: 0;
                                padding-right: 0;
                                padding-top: 30px;
                            }
                            .labelPackageDetail {
                                left: 0;
                                position: absolute;
                                top: 5px;
                            }
                            .removeFeedPackage {
                                bottom: auto;
                                position: absolute;
                                right: 0;
                                top: 5px;
                            }
                        }
                        @media (max-width: 767px){
                            
                            .hideUnder767{
                                display: none;
                            }
                            .showUnder767{
                                display: block;
                            }
                            .fullWidth767{
                                width: 100%;
                            }
                            .clearPaddingLeft767{
                                padding-left: 0;                        
                            }
                            .marginTop767{
                                margin-top: 15px;
                            }
                        }
                        @media (max-width: 550px){
                        
                        }
                        @media (max-width: 480px){
                            
                            .hideUnder480{
                                display: none;
                            }
                            .showUnder480{
                                display: block;
                            }
                            .fullWidth480{
                                width: 100%;
                            }
                            .overideColMd6 .col-md-6 input{
                                width: 48%;
                            }
                            .overideColMd6 .col-md-6 button{
                                float: right;
                                margin-top: 1px;
                                width: 48%;
                            }
                        }
                        @media (max-width: 379px){
                            .hideUnder379{
                                display: none;
                            }
                            .showUnder379{
                                display: block;
                            }
                            .fullWidth379{
                                width: 100%;
                            }
                            .overideColMd6 .col-md-6 input{
                                width: 100%;
                       
                            }
                            .overideColMd6 .col-md-6 button{
                                float: right;
                                margin-top: 10px;
                                width: 100%;
                            }
                        }
                        .container{
                            min-width: 320px;
                        }
                        .iMiniMarginBottom{
                            margin-bottom: 5px;
                        }
                        .iMiniMarginTop{
                            margin-top: 5px;
                            float: left;
                        }
                        .error{
                            border-color:red !important;
                        }
                        .errorMsg{
                            display:none;
                        }
                         .miniPaddingTop{
                        padding-top: 5px;
                        }
                        .orderComplete .showAfterOrderComplete{
                         display: inherit;
                        }
                        .orderComplete .hideAfterOrderComplete{
                          display: none;
                        }              
                        
                        
                        .headerRow{
                            margin: 0;
                            padding-bottom: 8px;
                            padding-top: 10px;
                            border-bottom: 2px solid #c0c0c0;
                        }
                        .dataRow{
                            margin: 0;
                            padding: 8px 0;
                            border-bottom: 1px solid #c0c0c0;
                        }
                        .subHeader{
                            width:100%;padding-bottom:10px;
                        }
                        
                    </style>
                            
  </head>
<body id="comp" class="store">              
               <apex:form id="theForm">
                    <apex:actionFunction name="payByCard" action="{!doPayByCard}" oncomplete="showUserPayment('card','');" rerender="theForm"/> 
                    <apex:actionFunction name="createTransaction" action="{!doTransaction}" oncomplete="finishTrans({!isErrorTrans},'{!refURL}');" rerender="script, conf_trans">
                        <apex:param name="payId" assignTo="{!paymentId}" value=""/>
                    </apex:actionFunction>
                    <apex:actionFunction name="deletePaymentMethod" action="{!doDeletePayment}" rerender="deletePayment">
                        <apex:param name="payId" assignTo="{!paymentId}" value=""/>
                    </apex:actionFunction>  
                    
                    <div class="container wrapContentBg">
                         <div class="row">
                            <div class="col-md-12">
                                <div class="wrapMeByBlock clearPadding spacingTop iRadius paddingRight removeBackground removeAllPadding">                                                                              
                                        
                                     
                                    <div class="col-md-4 col-sm-5 col-xs-6 setRight clearPaddingRight fullWidth767 clearPaddingLeft767 marginTop767">
                                        <div class="wrapItemRightByBlock iRadius"> 
                                             
                                             <div class="col-md-6 col-sm-6 col-xs-6 clearPadding lb radiusBottomLeft" style="border-bottom: 0;">
                                                    <span class="lblTotal">Total</span>
                                                </div>
                                                <div class="col-md-6 col-sm-6 col-xs-6 clearPadding vl radiusBottomRight" style="border-bottom: 0;">
                                                    <apex:outputText styleclass="totalPrice" value="£{0, number, ###,##0.00}">
                                                        <apex:param value="{!totalPrice}" />
                                                    </apex:outputText>
                                                </div>
                                             
                                             
                                            <div class="userNoPayment hideAfterOrderComplete trans-hide">
                                                <div class="iBold iMiniMarginTop">
                                                    Select a payment option:
                                                </div>                                              
                                                <button class="btnOrange inputFullWidth btnPayByCard spacingTop" onclick="payByCard(); return false;"><span class="iconpayByCard">Pay by Credit/Debit Card</span></button>
                                                 
                                            </div>
                                            <!-- 2015-01-15 - Commented out by Steve Paul for user testing -->
                                            <apex:outputPanel id="methodList">
                                            <div class="userHavePayment hideAfterOrderComplete trans-hide">
                                                <div class="iBold iMiniMarginTop inputFullWidth">
                                                    <span class="showEdit iHiden cancelEditPayment iColorOrange cancelIcon">Cancel</span>
                                                    <span class="hideEdit titleHasPayment">Select a payment method:</span>
                                                    <span class="hideEdit editPayment makeUpEdit setRight">Edit</span>
                                                    <span class="showEdit iHiden doneEditPayment iColorOrange">Done</span>
                                                </div>
                                                
                                                <ul class="wrapActionPayment"> 
                                                
                                                    <apex:repeat value="{!lstBV}" var="item">
                                                        <li> 
                                                            <input id="{!item.id}" type="radio" name="checkPayment" data-value="{!item.id}"/> 
                                                            <label for="{!item.id}">
                                                                <span class="iconPayment">
                                                                        <apex:outputText value="{!item.PaymentType__c}" escape="false"/>
                                                                </span>
                                                                <div class="wrapLbBlCheck">
                                                                    <span class="lbCheck">{!item.Payment_Type_Value__c}</span>
                                                                    <span class="valueCheck">{!item.Masked_card_number__c}</span>
                                                                    <span class="valueCheck">{!item.PayPal_email__c}</span>
                                                                </div>
                                                            </label>
                                                            <span class="deletePayment iHiden">
                                                                <img style="background: #fff;width: 30px;" src="{!URLFOR($Resource.P2P_ResMyCheckout, 'close_warning.png')}" data-value="{!item.id}"/>
                                                            </span>
                                                        </li>
                                                    </apex:repeat>
                                                    <li>
                                                        <div id="future-payment"></div>
                                                        <a class="addPayMentMethod">
                                                            <span class="iColorGrey plusIconSize fa fa-plus-circle"></span> Add payment method
                                                        </a>
                                                    </li>
                                                </ul>
                                               
                                                <div>
                                                    <button class="btnOrange inputFullWidth spacingTop btnConfirmPay">
                                                        <span class="iconpayByCard" id="btnConfirmPay">
                                                            Confirm and pay 
                                                            <apex:outputText value=" £{0, number, ###,##0.00}">
                                                                <apex:param value="{!totalPrice}" />
                                                            </apex:outputText>
                                                        </span>
                                                    </button>
                                                </div>
                                                 
            
                                            </div>
                                            </apex:outputPanel> 
                                        </div>
                                        <div class="wrapItemRightByBlock iRadiusTop spacingTop blurEditListItem">
                                                <div class="miniTitle inputFullWidth">Secure Payments</div>
                                                <div class="setLeft inputFullWidth" style="margin-top: 10px;">
                                                    <div class="col-md-5 col-sm-5 col-xs-6 clearPadding">
                                                        <div class="iBold inputFullWidth">Card payments processed by:</div>
                                                    </div>
                                                    <div class="col-md-7 col-sm-7 col-xs-6" style="padding-right: 0;">
                                                        <a style="text-align: right; margin-top: 6px;" class="setLeft inputFullWidth" href="https://www.braintreegateway.com/merchants/6czrysgdw2jpd5pc/verified" target="_blank">
                                                            <img style="max-width: 100%;" src="https://braintree-badges.s3.amazonaws.com/07.png" border="0"/>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="wrapItemRightByBlock iRadiusBottom spacingTop blurEditListItem" style="margin-top: 2px;">
                                                
                                                <div class="iBold inputFullWidth">We accept these secure payments:</div>
                                                <div class="wrapAvailablePaymentMethod">
                                                    <img class="payment_method" src="{!URLFOR($Resource.P2P_ResMyCheckoutPayment, 'payment_method.png')}"/>
                                                    <img class="grey_lock" src="{!URLFOR($Resource.P2P_ResMyCheckoutPayment, 'grey_lock.png')}"/>
                                                </div>
                                         </div>

                                    </div>
                                             
                                </div>
                            </div>        
                        </div>
                    </div>
                    
                    
<!--                popup creditcard -->
                    <div id="creditCard_popup" class="popup">
                        <div class="row">
                            <div class="col-md-12 col-sm-12 col-xs-12 clearPadding767">
                                <iframe id="pay-frame" scrolling="no" src="{!URLFOR('apex/P2P_PayToBraintree?ccregaccid=')}{!accid}" width="100%" height="100%" frameborder="0"></iframe>
                            </div>
                        </div>
                        <img class="close_popup" alt="Close" src="{!URLFOR($Resource.P2P_Resources, 'svg/close.svg')}"/>
                    </div>

<!--                    end creditcard -->

<!--                popup confirm-->
                    <apex:outputPanel id="conf_trans">
                        <div id="confirm_trans" class="popup">
                             <div class="row">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div class="miniTitle iSeperateBorder spacingBottom">Confirm Transaction</div>
                                    <div class="col-md-12 col-sm-12 col-xs-12 clearPadding" style="overflow: auto;">
                                         <apex:outputText value="{!errorMsg}" rendered="{!isErrorTrans}" escape="false" style="color:#F00;"/>
                                         <apex:outputText rendered="{!NOT(isErrorTrans)}">Successful!</apex:outputText>
                                    </div>                                  
                                </div>
                            </div>
                            <img class="close_popup" alt="Close" src="{!URLFOR($Resource.P2P_Resources, 'svg/close.svg')}"/>
                        </div>
                    </apex:outputPanel>

<!--                    end confirm-->

                              
                    <apex:outputPanel id="deletePayment"></apex:outputPanel>
                    
                    <apex:outputPanel id="braintreeScript">
                        <script src="https://js.braintreegateway.com/v2/braintree.js"></script> 
                    </apex:outputPanel>
                    
                    <apex:outputPanel id="script">
                    <script>
                                                
                        function assignVal2remove(parentIndex, subIndex){
                            setIndexProductGroupANDProduct(parentIndex, subIndex);
                            removeMediabasket();
                        }

                        //=== kakada edit Task #4829=====
                        $("pay-frame").load(function(){
                            autoResize(frame);
                        });
                        var frame;
                        window.resizeFrame = function(h){
                            frame = h;
                            autoResize(h);
                        }
                        function autoResize(h){                             
                            document.getElementById("pay-frame").height= (h) + "px";
                        }
                        
                        var selectCard;
                        window.closePupup = function(token){
                            selectCard = token;                           
                            payByCard();    
                            $('#creditCard_popup').popup('hide');
                        }

                        function showUserPayment(type,selectId){
                            $('.userHavePayment').show();
                            if(type == 'card'){
                                $('.addPayMentMethod').show();
                                $('#future-payment').hide();
                                autoSelectRadio(selectCard);
                            }else{
                                autoSelectRadio(selectId);
                                $("#braintree-paypal-button").html($('.addPayMentMethod').html()).css({"width":"auto","height":"auto","font-size":"18px"});
                                $('#future-payment').show();
                                $('.addPayMentMethod').hide();
                            }
                        }
                        
                        function autoSelectRadio(id){
                            if(id != null && id != ""){
                               $("#"+id).attr("checked",true);
                               var checked = $("input:radio[name='checkPayment']:checked");
                               if(checked.val()){
                                   $('.btnConfirmPay').removeClass("btnGrey");
                                   $('.btnConfirmPay').addClass("btnOrange");
                               }else{
                                   $('.btnConfirmPay').removeClass("btnOrange");
                                   $('.btnConfirmPay').addClass("btnGrey");
                               }
                            }
                        }
                        
                        function doTransaction(){
                            var checked = $("input:radio[name='checkPayment']:checked");
                            createTransaction(checked.attr('data-value'));
                            return false;
                        }
                        function finishTrans(isErrorTrans,ref){
                            if(!isErrorTrans){  
                                window.opener.location.href = '/'+ref;
                                window.close();
                            }else{  
                                $('#confirm_trans').popup('show');
                            }
                        }
                        $(".deletePayment img").click(function(){
                            var ans = confirm("Are you sure you would like to remove this payment method?");
                            if(ans){
                                deletePaymentMethod($(this).attr('data-value'));
                                $(this).parent().parent().hide();
                            }
                        });
                        //=== end edit Task #4829===== 
                    </script>
                                   
                    <script>
                            $(document).ready(function(){
                                function addNewComContact(){
                                    $('.userHavePayment').addClass('activeEditPayment');
                                    $('.blurEditListItem').each(function(){
                                        $(this).addClass('transparent_content');
                                    });
                                }
                                
                                function saveCancelAddComContact(){
                                    $('.userHavePayment').removeClass('activeEditPayment');
                                    $('.blurEditListItem').each(function(){
                                        $(this).removeClass('transparent_content');
                                    });
                                }
                                $('.editPayment').click(function(){
                                     addNewComContact();
                                     $("input:radio[name='checkPayment']:checked").each(function(){
                                         $(this).attr('checked', false);  
                                     });
                                     $('.btnConfirmPay').removeClass("btnOrange");
                                     $('.btnConfirmPay').addClass("btnGrey");
                                     $('.addPayMentMethod').parent().hide();
                                     $('.btnConfirmPay').parent().hide();
                                });
                                $('.cancelEditPayment').click(function(){
                                    saveCancelAddComContact();
                                    $('.addPayMentMethod').parent().show();
                                    $('.btnConfirmPay').parent().show();
                                });
                                $('.doneEditPayment').click(function(){
                                    saveCancelAddComContact();
                                    $('.addPayMentMethod').parent().show();
                                    $('.btnConfirmPay').parent().show();
                                });
                                
                                $('#my_popup .close_popup, .btnCancelTermCondiction').off('click')
                                  .on('click',function(){
                                      $('#my_popup').popup('hide');
                                  });
                                $('#paypal_popup .close_popup').off('click')
                                  .on('click',function(){
                                      $('#paypal_popup').popup('hide');
                                });
                                 
                                $('.addPayMentMethod').off('click')
                                .on('click',function(){
                                    $('#pay-frame').attr("src", $('#pay-frame').attr("src"));
                                    $('#creditCard_popup').popup('show');
                                    return false;
                                });
                                
                                $('#creditCard_popup .close_popup').off('click')
                                  .on('click',function(){
                                      $('#creditCard_popup').popup('hide');
                                });
                                $('#confirm_trans .close_popup').off('click')
                                  .on('click',function(){
                                      $('#confirm_trans').popup('hide');
                                });
                                 
                                var checked = $("input:radio[name='checkPayment']:checked");
                                if (!checked.val()){
                                    $('.btnConfirmPay').removeClass("btnOrange");
                                    $('.btnConfirmPay').addClass("btnGrey");
                                } 
                                
                                $("input:radio[name='checkPayment']").click(function(){
                                    $('.btnConfirmPay').removeClass("btnGrey");
                                    $('.btnConfirmPay').addClass("btnOrange");
                                }); 
                                
                                $('.btnConfirmPay').hover(function(){
                                        if($(this).hasClass("btnGrey")){
                                            $(this).html('<span id="btnConfirmPay" class="iconpayByCard">Please select a payment method</span>');
                                        }
                                    },function(){
                                        if($(this).hasClass("btnGrey")){
                                            $(this).html('<span id="btnConfirmPay" class="iconpayByCard">Confirm and pay 
                                                            <apex:outputText value=" £{0, number, ###,##0.00}">
                                                                <apex:param value="{!totalPrice}" />
                                                            </apex:outputText></span>');
                                        }
                                });
                                $('.btnConfirmPay').off('click').on('click',function(){
                                    if ($(this).hasClass("btnGrey")){
                                       return false;
                                    }else if("{!totalPrice}" <= 0){
                                        alert('Cannot pay Total = '+"{!totalPrice}");
                                    }
                                    else {
                                      //$('#my_popup').popup('show',{scrolllock: true});
                                      doTransaction();
                                      $(this).addClass("btnGrey"); // Bunhor @7-May-15: avoiding exe many times when dclick
                                    }
                                    return false;
                                });
                                
                                //=========End edit Task #4829==========
                                
                            });
                        </script>
                        </apex:outputPanel>
                </apex:form>

            </body>
    </apex:page>